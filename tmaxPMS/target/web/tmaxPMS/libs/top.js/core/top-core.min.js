Top=function(){function Top(){}Top.version="";Top.getVersion=function(){return this.version};Top.setVersion=function(version){this.version=version};Top.doNotUseThisFuncEver=function(b){Top.__private=b};Top.__isPrivate=function(){return Top.__private};Top.libsPath="";Top.configs={};Top.events={onCreate:[],onBeforeLoad:[],onLoad:[],onRouteActivate:function(){return true},onRouteDeactivate:function(){return true},onWidgetAttach:{},onWidgetDetach:{},onLibsLoad:{}};Top.routes={};Top.modules={};Top.pages={};Top.pageSrcMap={};Top.curPage=null;Top.curRoute={};Top.dialogList={};Top.autoComleteContainers=[];return Top}();Top.App=function(){App.prototype=Object.create(Top.prototype);App.prototype.constructor=App;function App(){}App.create=function(options){Top.Loader.start("large");var _this=this;options=options||{};options.config=options.config||undefined;this.__initLibsPath();this.__initVersion();this.__initConfigs(options.config,function(){_this.__initAppController(options.controller);_this.__initRoute(options.route,function(){_this.__initEvent(options.event);_this.__initModule(options.module);_this.__initI18n(options.i18n);_this.__createPagesImpl();_this.__load()})});$(document).on("click",function(e){var openedSelectBox=this.querySelectorAll("top-selectbox .top-selectbox-container.active");var i=0;var openedSelectBoxLength=openedSelectBox.length;while(i<openedSelectBoxLength){openedSelectBox[i].click();i++}var openedDropdownMenu=this.querySelectorAll(".Menu_type_dropdown .top-menu_btn.top-menu_open");var i=0;var openedDropdownMenuLength=openedDropdownMenu.length;while(i<openedDropdownMenuLength){openedDropdownMenu[i].click();i++}var contextMenu=this.querySelectorAll("top-contextmenu .top-contextmenu-container.open");if(contextMenu){var i=0;var contextMenuLength=contextMenu.length;while(i<contextMenuLength){var menuId=contextMenu[i].parentNode.parentNode.id;Top.Dom.selectById(menuId).close();i++}}e.stopPropagation()});window.addEventListener("resize",function(e){var openedSelectBox=document.querySelectorAll("top-selectbox .top-selectbox-container.active");var i=0;var openedSelectBoxLength=openedSelectBox.length;while(i<openedSelectBoxLength){openedSelectBox[i].click();i++}var dropdownMenu=document.querySelectorAll(".Menu_type_dropdown .top-menu_btn.top-menu_open");if(dropdownMenu){var i=0;var dropdownMenuLength=dropdownMenu.length;while(i<dropdownMenuLength){if(dropdownMenu[i].parentNode.parentNode.parentNode.setDropdownPosition){dropdownMenu[i].parentNode.parentNode.parentNode.setDropdownPosition()}i++}}Top.curPage.template.__adjustLineHeight();e.stopPropagation()});document.addEventListener("scroll",function(e){if(e.target.classList&&e.target.classList.contains("top-tableview-scrollBody"))return;var openedSelectBox=this.querySelectorAll("top-selectbox .top-selectbox-container.active");var i=0;var openedSelectBoxLength=openedSelectBox.length;while(i<openedSelectBoxLength){openedSelectBox[i].click();i++}var openedHeaderMenu=this.querySelectorAll('top-menu[type="header"] .top-menu_open');i=0;var openedHeaderMenuLength=openedHeaderMenu.length;while(i<openedHeaderMenuLength){openedHeaderMenu[i].mouseleave();i++}var dropdownMenu=document.querySelectorAll('top-menu[type="dropdown"] .top-menu_btn.top-menu_open');if(dropdownMenu){i=0;var dropdownMenuLength=dropdownMenu.length;while(i<dropdownMenuLength){dropdownMenu[i].parentNode.parentNode.parentNode.setDropdownPosition();i++}}Top.App.closeAutoCompleteContainers()});Top.App.__preventTabOutsideDialog()};App.__preventTabOutsideDialog=function(){document.addEventListener("keyup",function(){if(document.getElementsByClassName("top-dialog-overlay").length>0){var dialogs=Top.App.getDialogs();var ids=Object.keys(Top.App.getDialogs());for(var i=0;i<ids.length;i++){var dialog=document.getElementById("top-dialog-root_"+ids[i]);if(event.target.id!==""&&dialog.querySelector("#"+event.target.id)==null){Top.Dom.selectById(event.target.id).blur()}}}})};App.__load=function(){if(location.hash===""){this.__callEvent(Top.events["onCreate"])}this.loaded=true;this.__callEvent(Top.events["onBeforeLoad"]);this.__callEvent(Top.events["onLoad"]);var pageNames=Object.keys(Top.pages);for(var i=0,len=pageNames.length;i<len;i++){var page=Top.pages[pageNames[i]];page.setProperties({visible:"none"})}if(!Top.curPage){console.error(Top.configs["indexPageId"]+" cannot be found.");return}if(App.__compatibleWithTOP()&&location.hash){this.__routeReplace(location.hash.replace("#!",""))}else if(!Top.curPage.loaded){this.__pageLoad(Top.curPage)}if(Top.curPage.loaded){this.__pageBeforeActivate(Top.curPage);this.__showPage(Top.curPage.id);this.__pageActivate(Top.curPage)}Top.Loader.stop()};App.__loadLibs=function(next){var _this=this;this.__loadExternalHtml(Top.libsPath+"widget/top-widgets.html",function(){next()})};App.__loadStyle=function(next){if(Top.configs.loadStyleSeparately===true||Top.configs.loadStyleSeparately==="true"){var link=document.createElement("link");link.href=Top.libsPath+"css/top-common.css";link.rel="stylesheet";link.onload=next;document.head.appendChild(link);link=document.createElement("link");if(Top.Util.Browser.isIE()){link.href=Top.libsPath+"css/top-common_ie.css"}else{link.href=Top.libsPath+"css/top-common_chrome.css"}link.rel="stylesheet";document.head.appendChild(link);var dir=Top.libsPath+"css/widget";var fileextension=".css";$.ajax({url:dir,success:function(data){$(data).find("a:contains("+fileextension+")").each(function(){var filename=Top.libsPath+"css/widget/"+this.text;if(this.text.endsWith("_ie.css")&&!Top.Util.Browser.isIE()||this.text.endsWith("_chrome.css")&&Top.Util.Browser.isIE()){return}link=document.createElement("link");link.href=filename;link.rel="stylesheet";document.head.appendChild(link)})}})}else{var link=document.createElement("link");if(Top.Util.Browser.isIE()){link.href=Top.libsPath+"css/top_ie.css"}else{link.href=Top.libsPath+"css/top.css"}link.rel="stylesheet";link.onload=next;document.head.appendChild(link)}if(Top.configs.deploy===undefined||Top.configs.deploy.useDefaultFont!=="false"&&Top.configs.deploy.useDefaultFont!==false){this.__loadFont()}};App.__loadFont=function(){var link=document.createElement("link");link.href=Top.libsPath+"css/font.css";link.rel="stylesheet";document.head.appendChild(link)};App.__loadUserStyle=function(next){if(typeof Top.configs.css==="object"){var styleList=Top.configs.css.filter(function(value){return typeof value==="string"&&!value.includes("_ie.css")});if(Top.Util.Browser.isIE()){styleList=styleList.concat(Top.configs.css.filter(function(value){return typeof value==="string"&&value.includes("_ie.css")}));if(typeof Top.configs.cssIE==="object"&&Top.configs.cssIE.length>0){styleList=styleList.concat(Top.configs.cssIE)}}}if(typeof styleList==="object"){var len=styleList.length;if(len===0){next()}else{var cnt=0;for(var i=0;i<len;i++){this.__loadExternalStyle(styleList[i],function(){cnt++;if(cnt===len)next()})}}}else if(styleList===undefined){next()}else{console.error("Config error: css or cssIE must be an array.");next()}};App.__loadUserLogic=function(next){if(typeof Top.configs.js==="object"){var logicList=Top.configs.js;var len=logicList.length;var cnt=0;for(var i=0,len=logicList.length;i<len;i++){Top.App.__loadExternalScript(logicList[i],function(){cnt++;if(cnt===len){Top.__isLoadedUserLogic=true;if(typeof next==="function")next();Top.App.__callEvent(Top.onLoadUserLogic);Top.onLoadUserLogic=[]}})}}else if(Top.configs.js===undefined){Top.__isLoadedUserLogic=true;if(typeof next==="function")next();Top.App.__callEvent(Top.onLoadUserLogic);Top.onLoadUserLogic=[]}else{console.error("Config error: js must be an array.");Top.__isLoadedUserLogic=true;if(typeof next==="function")next();Top.App.__callEvent(Top.onLoadUserLogic);Top.onLoadUserLogic=[]}};App.__loadControllerFile=function(controllerPaths,onLoad,param){var cnt=0;for(var i=0,len=controllerPaths.length;i<len;i++){Top.App.__loadExternalScript(controllerPaths[i],function(){cnt++;if(cnt===len){onLoad(param)}},function(){cnt++;if(cnt===len){onLoad(param)}})}};App.__loadExternalScript=function(url,onload,onerror){if(Top.App.__externalScriptList&&Top.App.__externalScriptList.indexOf(url)!=-1){onload();return}var script=document.createElement("script");script.src=url;script.onload=onload;script.onerror=onerror;script.async=false;script.charset="utf-8";document.head.appendChild(script);if(Top.App.__externalScriptList===undefined){Top.App.__externalScriptList=[]}Top.App.__externalScriptList.push(url)};App.__loadExternalHtml=function(url,onload){var link=document.createElement("link");link.rel="import";link.href=url;link.onload=onload;document.head.appendChild(link)};App.__loadExternalStyle=function(url,onload){var link=document.createElement("link");link.rel="stylesheet";link.href=url;link.onload=onload;document.head.appendChild(link)};App.onLoadUserLogic=function(callback){if(Top.__isLoadedUserLogic===true){callback()}else{if(Top.onLoadUserLogic===undefined)Top.onLoadUserLogic=[];Top.onLoadUserLogic.push(callback)}};App.__pageLoad=function(page){if(page.template.src){page.template.__srcLoad(function(){page.setProperties({loaded:true});Top.App.__execPageEvent(page,"onLoad");if(!page.getProperties("activated")){Top.App.__pageBeforeActivate(page);Top.App.__showPage(page.id);Top.App.__pageActivate(page)}Top.App.__makeTooltip(page);Top.App.__makeContextMenu(page)})}else{page.setProperties({loaded:true});page.loaded=true;this.__execPageEvent(page,"onLoad");this.__makeTooltip(page);Top.App.__makeContextMenu(page)}};App.__makeTooltip=function(page){var span=document.createElement("span");span.className="top-tooltip-text";page.template.appendChild(span);var div=document.createElement("div");div.className="top-tooltip-arrow";page.template.appendChild(div)};App.__makeContextMenu=function(page){var contextmenu=Top.Widget.create("top-contextmenu");page.template.appendChild(contextmenu.template);_callCallback(contextmenu.template,"attached");Top.ContextMenu.setWidget(contextmenu)};App.__pageBeforeActivate=function(page){this.__execPageEvent(page,"onBeforeActivate")};App.__pageActivate=function(page){page.onActivate(function(){});Top.curPage=page;page.setProperties({activated:true});this.__execPageEvent(page,"onActivate")};App.__pageDeactivate=function(page){page.onDeactivate(function(){});page.setProperties({activated:false});this.__execPageEvent(page,"onDeactivate")};App.__initLibsPath=function(){var path=document.getElementById("top.js").src;var fileName=Top.Util.getFileName(path);Top.libsPath=path.split(fileName)[0]};App.__initVersion=function(){Top.Ajax.execute(Top.libsPath+"core/version",{success:function(data){Top.setVersion(data)}})};App.__initConfigs=function(configs,next){if(typeof configs==="string"){var _this=this;Top.Ajax.execute(configs,{success:function(data){Top.configs=JSON.parse(data);_this.__postInitConfigs(next)}})}else if(typeof configs==="object"){var keys=Object.keys(configs);for(var i=0,len=keys.length;i<len;i++){var key=keys[i];var value=configs[key];Top.configs[key]=value}this.__postInitConfigs(next)}else{console.error("Config is not defined.")}};App.__postInitConfigs=function(next){this.__initDebug(Top.configs.debug);if(Top.configs.indexPageId===undefined){console.error("Config error: indexPageId must be defined.");return}if(Top.configs.name===undefined){Top.configs.name="TOP Application"}this.setTitle(Top.configs.name);var _this=this;this.__loadStyle(function(){_this.__loadUserStyle(function(){if(Top.App.__compatibleWithTOP()){Top.App.onBeforeLoad(_this.__loadUserLogic);next()}else{_this.__loadUserLogic(function(){next()})}})})};App.getConfig=function(key){return Top.configs[key]};App.getConfigs=function(){return Top.configs};App.setTitle=function(title){document.title=title};App.onBeforeLoad=function(func){Top.events.onBeforeLoad.push(func)};App.onLoad=function(func){if(this.isLoaded()){func()}else{Top.events.onLoad.push(func)}};App.isLoaded=function(){return this.loaded};App.__initAppController=function(controllerName){if(typeof controllerName!=="string")return;var controller=Top.Controller.get(controllerName);if(typeof controller==="object"){Top.Controller.setAppController(controller);controller.__setBoundWidget()}else{console.error(controllerName+" cannot be found.")}};App.__initModule=function(module){if(typeof module!=="object")return;Top.modules=module};App.__initEvent=function(events){if(typeof events!=="object")return;var len=Object.keys(events).length;for(var i=0;i<len;i++){var key=Object.keys(events)[i];var value=events[key];if(Top.events[key]){Top.events[key].push(value)}}};App.__initI18n=function(settings){if(typeof settings!=="object")return;Top.i18n.load(settings)};App.__initDebug=function(settings){if(typeof settings!=="object")return;if(typeof settings.livereload==="object"&&Top.Util.Browser.isChrome()){this.__initLiveReload(settings.livereload)}};App.__initLiveReload=function(userOptions){var options={host:"localhost",port:"52790"};Object.assign(options,userOptions);var liveReload=Top.LiveReload.create({options:options});if(liveReload.WebSocket!=null){liveReload.connect()}};App.addEvent=function(event){this.__initEvent(event)};App.__callEvent=function(events,params){if(typeof events==="object"){for(var i=0,len=events.length;i<len;i++){this.__callEventImpl(events[i],params)}}else if(typeof events==="function"){this.__callEventImpl(events,params)}else if(typeof events==="string"){var fn=Top.Util.namespace(events);if(typeof fn==="function")fn()}};App.__callEventImpl=function(eventFunc,params){if(typeof eventFunc==="string"){if(location.hash==""){Top.Util.namespace(eventFunc)(params)}}else{eventFunc(params)}};App.__execPageEvent=function(page,event){var func=page.template[event];if(typeof func==="function")func(page)};App.__initRoute=function(routings,next){if(typeof routings==="string"){var _this=this;Top.Ajax.execute(routings,{success:function(data){var dataObj=JSON.parse(data);_this.__initObjectDepth(dataObj,0);Top.routes=_this.__createRoutes(dataObj);_this.__postInitRoute();next()}})}else if(typeof routings==="object"){this.__initObjectDepth(routings,0);Top.routes=this.__createRoutes(routings);this.__postInitRoute();next()}else{this.__postInitRoute();next()}};App.addRoute=function(routings){if(typeof routings==="string"){var _this=this;Top.Ajax.execute(routings,{success:function(data){var dataObj=JSON.parse(data);_this.__initObjectDepth(dataObj,0);Object.assign(Top.routes,_this.__createRoutes(dataObj))}})}else if(typeof routings==="object"){this.__initObjectDepth(routings,0);Object.assign(Top.routes,this.__createRoutes(routings))}};App.__initObjectDepth=function(object,level){object.__depth=level;level++;for(var key in object){if(typeof object[key].route==="object"){this.__initObjectDepth(object[key].route,level)}}};App.__createRoutes=function(routeInfo){var routes={};var keys=Object.keys(routeInfo);for(var i=0,len=keys.length;i<len;i++){var from=keys[i];var to=routeInfo[from];if(from!=="__depth"&&typeof to!=="object"){temp=to;to={};to.activate=temp}if(typeof to.activate==="function"){to.__dest=this.__makeDestFunction(to,from,routeInfo.__depth)}else if(typeof Top.Util.namespace(to.activate)==="function"){to.activate=Top.Util.namespace(to.activate);to.__dest=this.__makeDestFunction(to,from,routeInfo.__depth)}else if(typeof to.activate==="string"&&Top.Dom.selectById(to.activate)){to.__dest=this.__makeDestPage(to)}else if(to.activate===undefined){to.activate=function(params,data,next){next()};to.__dest=this.__makeDestFunction(to,from,routeInfo.__depth)}else{console.error("Routing error: '"+to.activate+"' is not defined.")}routes[from]={};routes[from].dest=to.__dest;if(typeof to.route==="object"){routes[from].route=this.__createRoutes(to.route)}}return routes};App.__postInitRoute=function(){Top.routes["/"]={};Top.routes["/"].dest=function(){window.location=document.location.origin+document.location.pathname}};App.routeTo=function(path,data,__popstate){var route=this.__searchRoute(Top.routes,path);if(route!==undefined&&typeof route.dest==="function"){route.dest(path,data,__popstate)}else if(Array.isArray(route)){var i=0;var makeNext=function(){i++;if(i<route.length-1){return route[i].dest(path,data,__popstate,makeNext)}else if(i===route.length-1){return route[i].dest(path,data,__popstate)}};route[0].dest(path,data,__popstate,makeNext)}else{Top.App.__notFoundPage(path)}};App.__notFoundPage=function(path){var _this=this;var pageSource404=_this.page404||"page/contents_404.html";var imageSource404=_this.image404||"page/res/error_img_404.png";console.error("Routing error: "+path+" is not defined.");window.history.pushState({path:path},"","#!"+path);Top.curPage.src(Top.libsPath+pageSource404,function(){var layout=Top.curPage.selectById("Top_404_error_layout");if(Top.curPage.selectById("imageError404"))Top.curPage.selectById("imageError404").setSrc(Top.libsPath+imageSource404);if(!_this.fn404_back){_this.fn404_back=function(layout){layout.selectById("backButton_404").setProperties({"on-click":"Top.App.back()"})}}if(!_this.fn404){_this.fn404=function(layout){layout.selectById("mainButton_404").setProperties({"on-click":"Top.App.routeTo('/')"})}}_this.fn404_back(layout);_this.fn404(layout)})};App.onLoad404=function(fn){this.fn404=fn};App.reset404=function(pageSrc,imageSrc){this.page404=pageSrc;this.image404=imageSrc};App.load404Page=function(){Top.App.__notFoundPage("/404")};App.__notAccessPage=function(path){var _this=this;var pageSource403=_this.page403||"page/contents_403.html";var imageSource403=_this.image403||"page/res/error_img_403.png";console.error("Access error: You are not authorized to view this page");window.history.pushState({path:path},"","#!/403");Top.curPage.src(Top.libsPath+pageSource403,function(){var layout=Top.curPage.selectById("Top_403_error_layout");if(Top.curPage.selectById("imageError403"))Top.curPage.selectById("imageError403").setSrc(Top.libsPath+imageSource403);if(!_this.fn403_back){_this.fn403_back=function(layout){layout.selectById("backButton_403").setProperties({"on-click":"Top.App.back()"})}}if(!_this.fn403){_this.fn403=function(layout){layout.selectById("mainButton_403").setProperties({"on-click":"Top.App.routeTo('/')"})}}_this.fn403_back(layout);_this.fn403(layout)})};App.reset403=function(pageSrc,imageSrc){this.page403=pageSrc;this.image403=imageSrc};App.load403Page=function(fn){this.fn403=fn;Top.App.__notAccessPage()};App.__routeReplace=function(path){if(path!=null){this.routeTo(path,undefined,true)}else{var dest=Top.routes["/"].dest;dest()}};App.back=function(){window.history.back()};App.forward=function(){window.history.forward()};App.openWindow=function(path,name,features){window.open(window.location.href+"#!"+path,name,features)};App.__makeDestFunction=function(to,from,depth){return function(path,data,popstate,next){if(typeof Top.curRoute.deact==="function")Top.curRoute.deact();if(typeof to.deactivate==="string"){to.deactivate=Top.Util.namespace(to.deactivate)}if(typeof to.deactivate==="function"){Top.curRoute.deact=to.deactivate}else{Top.curRoute.deact=function(){}}var params={};var paramKeys=from.split("/");paramKeys.splice(0,1);var values=path.split("/");values.splice(0,1);if(to.type==="POST"||to.type==="post"){var query={};var lastIndex=values.length-1;if(values[lastIndex].includes("?")){var queryString=values[values.length-1].split("?")[1];var queryList=queryString.split("&");for(var i=0,len=queryList.length;i<len;i++){var queryValue=queryList[i].split("=");if(queryValue[0]!=="")query[queryValue[0]]=queryValue[1]}values[lastIndex]=values[lastIndex].replace("?"+queryString,"")}}if(paramKeys.length===1){for(var i=0,len=values.length;i<len;i++){if(paramKeys[0]===values[i]){params["_default"+i]=values[i]}}if(Object.keys(params).length===0){params[paramKeys[0].replace(":","")]=values[depth]}var pathLen=depth+1}else if(paramKeys.length>1){for(var i=0,len=values.length;i<len;i++){if(paramKeys[i].indexOf(":")!==-1){params[paramKeys[i].replace(":","")]=values[i]}else{params["_default"+i]=values[i]}}var pathLen=values.length}var routePath="";for(var i=0;i<pathLen;i++){routePath+="/"+values[i]}if(popstate!==true&&next===undefined){window.history.pushState({path:routePath},"","#!"+routePath)}Top.curRoute.before=Top.curRoute.path;Top.curRoute.path=routePath;Top.curRoute.act=to.activate;if(depth===0)Top.curRoute.params={};Object.assign(Top.curRoute.params,params);if(query)Top.curRoute.query=query;to.activate.call(Top.Controller.getAppController(),params,data,next)}};App.__makeDestPage=function(to){return function(path,data,popstate){Top.curRoute.path=path;Top.curRoute.act=to.activate;if(to.deactivate){Top.curRoute.deact=to.deactivate}else{Top.curRoute.deact=function(){}}if(popstate!==true)window.history.pushState({path:path},"","#!"+path);Top.App.__goToImpl(to.activate);Top.i18n.__clearBoundWidget()}};App.__searchRoute=function(routeObj,path,__fromInner){if(path.includes("?"))path=path.split("?")[0];if(routeObj===undefined)return undefined;if(routeObj[path]!==undefined){return routeObj[path]}var parts=path.split("/");parts.splice(0,1);var pattern="";for(var i=0,len=parts.length;i<len;i++){pattern+="/:([a-zA-Z0-9]+)"}var keys=Object.keys(routeObj);for(var i=0,len=keys.length;i<len;i++){var match=keys[i].match(pattern);if(match){return routeObj[match[0]]}}if(!__fromInner)return this.__searchInnerRoute(parts)};App.__searchInnerRoute=function(parts){var routes=[];var route=this.__searchRoute(Top.routes,"/"+parts[0],true);if(parts.length>1&&parts[0].length===0)return undefined;if(route!==undefined){routes.push(route)}else{return undefined}for(var i=1,len=parts.length;i<len;i++){if(routes[i-1]!==undefined)routes.push(this.__searchRoute(routes[i-1].route,"/"+parts[i],true))}return routes};App.__goToImpl=function(pageId){if(Top.curPage.getProperties("activated"))this.__pageDeactivate(Top.curPage);var page=Top.pages[pageId];if(page===undefined)return;if(!page.loaded){this.__pageLoad(page)}if(page.loaded){this.__pageBeforeActivate(page);this.__showPage(pageId);this.__pageActivate(page)}};App.__showPage=function(pageId){Top.curPage.setProperties({visible:"none"});var page=Top.pages[pageId];page.setProperties({visible:"visible"})};App.__createPagesImpl=function(){var elements=document.getElementsByTagName("top-page");var cnt=elements.length;for(var i=0;i<cnt;i++){var element=elements[i];if(!Top.pages.hasOwnProperty(element.id)){var widget=Top.Widget.create("top-page",undefined,element);Top.pages[widget.id]=widget;if(widget.getSrc()!==undefined)Top.pageSrcMap[widget.getSrc()]=widget.id}}Top.curPage=Top.pages[Top.configs["indexPageId"]];Top.curRoute.path="/";var params={};params.from=Top.curRoute.path;params.to=Top.curRoute.path;Top.events.onRouteActivate(params)};App.goToPage=function(pageId){Top.App.__goToImpl(pageId)};App.getPages=function(){return Top.pages};App.getCurrentPage=function(){return Top.curPage};App.getPage=function(pageId){return Top.pages[pageId]};App.getPageIdBySrc=function(src){return Top.pageSrcMap[src]};App.onWidgetAttach=function(widgetId,func){if(this.isWidgetAttached(widgetId)){func(Top.Dom.selectById(widgetId))}else{if(Top.events.onWidgetAttach[widgetId]===undefined){Top.events.onWidgetAttach[widgetId]=[]}Top.events.onWidgetAttach[widgetId].push(func)}};App.onWidgetDetach=function(widgetId,func){if(Top.events.onWidgetDetach[widgetId]===undefined){Top.events.onWidgetDetach[widgetId]=[]}Top.events.onWidgetDetach[widgetId].push(func)};App.isWidgetAttached=function(widgetId){return document.getElementById(widgetId)!=null};App.onRouteActivate=function(func){Top.events.onRouteActivate=func};App.onRouteDeactivate=function(func){Top.events.onRouteDeactivate=func};App.current=function(){var __current={};__current.before=Top.curRoute.before;__current.path=Top.curRoute.path;__current.params=Top.curRoute.params;if(Top.curRoute.query)__current.query=Top.curRoute.query;return __current};App.__compatibleWithTOP=function(){return Top.configs.compatibleWithTOP==="true"||Top.configs.compatibleWithTOP===true};App.__useCommonLogic=function(){return Top.configs.deploy&&(Top.configs.deploy.common==="true"||Top.configs.deploy.common===true)};App.addDialog=function(id,dialog){Top.dialogList[id]=dialog};App.removeDialog=function(id){delete Top.dialogList[id]};App.getDialogs=function(){return Top.dialogList};App.closeDialogs=function(){var ids=Object.keys(Top.dialogList);for(var i=0,len=ids.length;i<len;i++){Top.dialogList[ids[i]].close()}};App.openDialog=function(params){return Top.Action.dialogCreate(params)};App.addAutoCompleteContainer=function(autoCompleteContainer){Top.autoComleteContainers.push(autoCompleteContainer)};App.closeAutoCompleteContainers=function(){for(var i=0,len=Top.autoComleteContainers.length;i<len;i++){Top.autoComleteContainers[i].blur()}};App.closeOpenedSelectBox=function(){var openedSelectBox=document.querySelectorAll("top-selectbox .top-selectbox-container.active");var i=0;var openedSelectBoxLength=openedSelectBox.length;while(i<openedSelectBoxLength){openedSelectBox[i].click();i++}};App.createBlur=function(focusedWidgets){if(this.__blurLayout===undefined){this.__blurLayout=document.createElement("div");this.__blurLayout.setAttribute("style","position:fixed;top:0;left:0;width:100%;height:100%;background-color:#7d7d7d;opacity:0.5;z-index:100");this.getCurrentPage().template.appendChild(this.__blurLayout)}if(typeof focusedWidgets==="string"){this.__adjustFocusWidgets(focusedWidgets)}else if(typeof focusedWidgets==="object"){for(var i=0,len=focusedWidgets.length;i<len;i++){this.__adjustFocusWidgets(focusedWidgets[i])}}if(this.__userLayout===undefined){this.__userLayout=Top.Widget.create("top-layout");this.__userLayout.getElement(".top-layout-root")[0].setAttribute("style","position:fixed;top:0;left:0;width:100%;height:100%;background-color:transparent;z-index:101");this.getCurrentPage().template.appendChild(this.__userLayout.template)}return this.__userLayout};App.removeBlur=function(){if(this.__blurLayout!==undefined){this.__blurLayout.remove();delete this.__blurLayout}if(this.__userLayout!==undefined){this.__userLayout.template.remove();delete this.__userLayout}if(typeof this.__focusedWidgets==="object"){var widgetIds=Object.keys(this.__focusedWidgets);for(var i=0,len=widgetIds.length;i<len;i++){var widget=Top.Dom.selectById(widgetIds[i]);var zIndex=this.__focusedWidgets[widgetIds[i]];widget.setProperties({"z-index":zIndex})}}};App.__adjustFocusWidgets=function(widgetId){if(this.__focusedWidgets===undefined)this.__focusedWidgets={};var widget=Top.Dom.selectById(widgetId);if(widget!==null){var originZIndex=widget.getProperties("z-index");widget.setProperties({"z-index":101});this.__focusedWidgets[widget.id]=originZIndex}};return App}();Top.Action=function(){Action.prototype=Object.create(Top.prototype);Action.prototype.constructor=Action;function Action(){}Action.windowCreate=function(params){};Action.windowDestroy=function(params){};Action.pageNavigate=function(params){if(params.type==="forward"){Top.App.forward()}else if(params.type==="back"){Top.App.back()}else{Top.App.routeTo("/"+params.targetPage)}};Action.widgetCreate=function(params){for(var i=0,len=params.widgets.length;i<len;i++){var parent=Top.Dom.selectById(params.parentId);if(parent!==null){var widget=Top.Widget.create(params.widgets[i].type);this.__setWidgetProperties(widget,params.widgets[i]);this.__addWidget(parent,widget,params.targetIndex)}}};Action.widgetDestroy=function(params){for(var i=0,len=params.widgets.length;i<len;i++){var parent=Top.Dom.selectById(params.parentId);var widget=Top.Dom.selectById(params.widgets[i].id);if(parent!==null&&widget!==null){parent.removeWidget(widget);parent.complete()}}};Action.widgetChange=function(params){for(var i=0,len=params.widgets.length;i<len;i++){var keys=Object.keys(params.widgets[i]);var widget=Top.Dom.selectById(params.widgets[i].id);if(widget!==null){this.__setWidgetProperties(widget,params.widgets[i])}}};Action.widgetMove=function(params){var parent=Top.Dom.selectById(params.parentId);var widget=Top.Dom.selectById(params.targetId);if(parent!==null&&widget!==null){this.__addWidget(parent,widget,params.targetIndex)}};Action.FragmentShow=function(params){};Action.FragmentRemove=function(params){};Action.dialogCreate=function(params){if(typeof params!=="object")return;var id=params.id||Top.Util.guid();var newDialog=Top.Widget.create("top-dialog");params.id=id;params.removeOnClose=true;newDialog.setProperties(params);var page=Top.App.getCurrentPage();page.template.appendChild(newDialog.template);_callCallback(newDialog.template,"attached");newDialog.open();return newDialog};Action.__setWidgetProperties=function(widget,props){var keys=Object.keys(props);var obj={};var resourcePattern=/^@(string|color|dimen|raw|drawable|style|theme)(\/[a-zA-Z0-9]+)+$/;var isIncludedHeader=false;for(var i=0,len=keys.length;i<len;i++){if(keys[i]=="id"||keys[i]=="collectionHeaders"){if(keys[i]=="collectionHeaders")isIncludedHeader=true;continue}var value=props[keys[i]];if(resourcePattern.test(value)){var modifiedValue;var resourceType=value.split("/")[0];var resourceId=value.substr(value.indexOf("/")+1);switch(resourceType){case"@drawable":{modifiedValue=Top.DrawableManager.get(resourceId);break}case"@raw":{modifiedValue=Top.RawManager.get(resourceId);break}default:{resourceId=resourceId.substr(0,resourceId.lastIndexOf("/"));var resourceName=originValue.split("/");resourceName=resourceName[resourceName.length-1];switch(resourceType){case"@string":{modifiedValue=Top.ValuesManager.get("strings",resourceId)[resourceName];break}case"@color":{modifiedValue=Top.ValuesManager.get("colors",resourceId)[resourceName];break}case"@dimen":{modifiedValue=Top.ValuesManager.get("dimen",resourceId)[resourceName];break}}}}value=modifiedValue}if(keys[i]==="layoutWidth"||keys[i]==="layoutHeight"||keys[i]==="margin"||keys[i]==="padding"||keys[i]==="textSize"||keys[i]==="minSidth"||keys[i]==="minHeight"||keys[i]==="maxWidth"||keys[i]==="maxHeight"||keys[i]==="layoutTop"||keys[i]==="layoutLeft"||keys[i]==="tabMaxWidth"||keys[i]==="borderWidth"||keys[i]==="borderRadius"){if(!isNaN(parseFloat(value)))value=value.concat("px")}obj[keys[i]]=value}widget.setProperties(obj);if(isIncludedHeader)this.__setWidgetCollectionHeaderProperties(widget,props["collectionHeaders"])};Action.__setWidgetCollectionHeaderProperties=function(parentWidget,props){var keys=Object.keys(props);var obj={};var resourcePattern=/^@(string|color|dimen|raw|drawable|style|theme)(\/[a-zA-Z0-9]+)+$/;if(parentWidget.template.tagName==="TOP-TABLEVIEW"){for(var i=0,len=keys.length;i<len;i++){var value=props[keys[i]];if(resourcePattern.test(value)){var modifiedValue;var resourceType=value.split("/")[0];var resourceId=value.substr(value.indexOf("/")+1);switch(resourceType){case"@drawable":{modifiedValue=Top.DrawableManager.get(resourceId);break}case"@raw":{modifiedValue=Top.RawManager.get(resourceId);break}default:{resourceId=resourceId.substr(0,resourceId.lastIndexOf("/"));var resourceName=originValue.split("/");resourceName=resourceName[resourceName.length-1];switch(resourceType){case"@string":{modifiedValue=Top.ValuesManager.get("strings",resourceId)[resourceName];break}case"@color":{modifiedValue=Top.ValuesManager.get("colors",resourceId)[resourceName];break}case"@dimen":{modifiedValue=Top.ValuesManager.get("dimen",resourceId)[resourceName];break}}}}value=modifiedValue}if(keys[i]=="headerColumn"){this.__setWidgetCollectionItemProperties(parentWidget,value);continue}else if(keys[i]!=="parent"){obj[keys[i]]=value}}parentWidget.__setTableHeaderStyle(obj)}};Action.__setWidgetCollectionItemProperties=function(parentWidget,props){var resourcePattern=/^@(string|color|dimen|raw|drawable|style|theme)(\/[a-zA-Z0-9]+)+$/;for(var i=0,len=props.length;i<len;i++){var keys=Object.keys(props[i]);var obj={};if(parentWidget.template.tagName==="TOP-TABLEVIEW"){for(var j=0;j<keys.length;j++){var value=props[i][keys[j]];if(resourcePattern.test(value)){var modifiedValue;var resourceType=value.split("/")[0];var resourceId=value.substr(value.indexOf("/")+1);switch(resourceType){case"@drawable":
{modifiedValue=Top.DrawableManager.get(resourceId);break}case"@raw":{modifiedValue=Top.RawManager.get(resourceId);break}default:{resourceId=value.split("/")[1];var resourceName=value.split("/")[2];switch(resourceType){case"@string":{modifiedValue=Top.ValuesManager.get("strings",resourceId)[resourceName];break}case"@color":{modifiedValue=Top.ValuesManager.get("colors",resourceId)[resourceName];break}case"@dimen":{modifiedValue=Top.ValuesManager.get("dimen",resourceId)[resourceName];break}}}}value=modifiedValue}if(keys[j]!=="parent"){obj[keys[j]]=value}}}parentWidget.__setHaderColumnStyle(obj)}};Action.__addWidget=function(parent,widget,targetIndex){if(typeof parent.addWidgetByIndex==="function"){parent.addWidgetByIndex(widget,targetIndex)}else{parent.addWidget(widget)}parent.complete();parent.adjustWidgets()};return Action}();Top.Data=function(){Data.prototype=Object.create(Top.prototype);Data.prototype.constructor=Data;Data.map={};Data.prototype.__allValues={};Data.prototype.__boundWidgets={};Data.prototype.__boundDevices={};Data.prototype.__initialValues={};Data.prototype.__isBackward=false;Data.prototype.__modelInfo={};function Data(obj,name){Object.assign(this,obj);this.id=Top.Util.guid();this.__boundWidgets={};this.__boundDevices={};this.__name=name;this.__getAllValues(this);var keys=Object.keys(this.__allValues);for(var i=0,len=keys.length;i<len;i++){if(typeof this.__allValues[keys[i]]==="string"&&this.__allValues[keys[i]].startsWith("{#")){this.__initBoundDevices(keys[i],this.__allValues[keys[i]].replace("{#","").replace("}",""))}}this.__initialValues=this.getValues()}Data.create=function(name,data){if(typeof name==="object"&&data===undefined){return new Data(name,"")}else if(typeof name==="string"&&typeof data==="object"){if(Top.Controller.current===undefined){window[name]=new Data(data,name)}else{if(Top.Controller.map[Top.Controller.current][name]===undefined){var dataImpl=new Data(data,name);this.map[name]=dataImpl;Top.Controller.map[Top.Controller.current][name]=dataImpl}}}else{console.error("Type error: Top.Data.create(string, object)")}};Data.prototype.__getAllValues=function(object,parentName){var keys=Object.keys(object);if(typeof parentName==="undefined"){parentName=""}else{parentName=parentName+"."}for(var i=0,len=keys.length;i<len;i++){if(typeof object[keys[i]]==="object"&&object[keys[i]]!=null){this.__getAllValues(object[keys[i]],parentName+keys[i])}else{this.__allValues[parentName+keys[i]]=object[keys[i]]}}};Data.prototype.__initBoundDevices=function(dataField,value){var parts=value.split(".");for(var i=0;i<parts.length;i++){if(Top.Util.namespace(parts[i])instanceof Top.Device){var device=Top.Util.namespace(parts[i]);var valuePath=value.split(parts[i]+".")[1];break}}device.__addBoundData(valuePath,this,dataField);this.__addBoundDevice(dataField,device,valuePath);this.setValue(dataField,device.getValue(valuePath))};Data.prototype.__addBoundWidget=function(valuePath,widgetId,prop){valuePath=valuePath.split("+")[0];var bindingInfo={};bindingInfo.widgetId=widgetId;bindingInfo.property=prop;bindingInfo.valuePath=valuePath;var parts=valuePath.split(".");var bindingPath=parts[0];if(this.__boundWidgets[bindingPath]===undefined)this.__boundWidgets[bindingPath]=[];if(this.__hasBindingInfo(bindingPath,bindingInfo)===false){this.__boundWidgets[bindingPath].push(bindingInfo)}for(var i=1,len=parts.length;i<len;i++){bindingPath+="."+parts[i];if(this.__boundWidgets[bindingPath]===undefined)this.__boundWidgets[bindingPath]=[];if(this.__hasBindingInfo(bindingPath,bindingInfo)===false){this.__boundWidgets[bindingPath].push(bindingInfo)}}};Data.prototype.__hasBindingInfo=function(path,info){var widgets=this.__boundWidgets[path];for(var i=0,len=widgets.length;i<len;i++){if(widgets[i].widgetId===info.widgetId&&widgets[i].property===info.property&&widgets[i].valuePath===info.valuePath){return true}}return false};Data.prototype.__updateBoundWidgets=function(key,__fromWidgetId,__fromControllerWidgetId){if(typeof key==="object"){for(var i=0,len=key.length;i<len;i++){this.__updateBoundWidgetsImpl(key[i],__fromWidgetId,__fromControllerWidgetId)}}else{this.__updateBoundWidgetsImpl(key,__fromWidgetId,__fromControllerWidgetId)}};Data.prototype.__updateBoundWidgetsImpl=function(key,__fromWidgetId,__fromControllerWidgetId){var key=this.__searchBoundKey(key);if(this.__boundWidgets&&this.__boundWidgets[key]){var bindingInfoList=this.__boundWidgets[key];for(var i=0,len=bindingInfoList.length;i<len;i++){var bindingInfo=bindingInfoList[i];if(__fromWidgetId&&bindingInfo["widgetId"]==__fromWidgetId)continue;else if(__fromControllerWidgetId&&bindingInfo["widgetId"]!=__fromControllerWidgetId)continue;var widget=Top.Dom.selectById(bindingInfo["widgetId"]);if(__fromControllerWidgetId&&bindingInfo["__isInitCalled"]&&widget&&widget.template.tagName==="TOP-TABLEVIEW")continue;if(bindingInfo["__isInitCalled"]===undefined)bindingInfo["__isInitCalled"]=true;var prop=bindingInfo["property"];var value=prop==="items"?this.getValue(bindingInfo["valuePath"].split("+")[0]):this.getValue(bindingInfo["valuePath"]);var obj={};obj[prop]=value;if(widget)widget.setProperties(obj,true)}}};Data.prototype.__searchBoundKey=function(key){var parts=key.split(".");var path=key;var boundKey="";if(this.__boundWidgets[path]){boundKey=path}else{for(var i=1,len=parts.length;i<len;i++){var pos=path.lastIndexOf(parts[len-i]);path=path.substring(0,pos-1);if(this.__boundWidgets[path]&&this.__hasValuePath(this.__boundWidgets[path],path)){boundKey=path;break}}}return boundKey};Data.prototype.__hasValuePath=function(list,valuePath){for(var i=0,len=list.length;i<len;i++){if(list[i].valuePath==valuePath){return true}}return false};Data.prototype.__addBoundDevice=function(dataField,device,valuePath){var pathRoot=dataField.split(".")[0];var bindingInfo={};bindingInfo.device=device;bindingInfo.dataField=dataField;bindingInfo.valuePath=valuePath;if(this.__boundDevices[pathRoot]===undefined)this.__boundDevices[pathRoot]=[];this.__boundDevices[pathRoot].push(bindingInfo)};Data.prototype.__updateBoundDevices=function(key){if(typeof key==="object"){for(var i=0,len=key.length;i<len;i++){this.__updateBoundDevicesImpl(key[i])}}else{this.__updateBoundDevicesImpl(key)}};Data.prototype.__updateBoundDevicesImpl=function(key){if(this.__boundDevices&&this.__boundDevices[key]){var bindingInfoList=this.__boundDevices[key];for(var i=0,len=bindingInfoList.length;i<len;i++){var bindingInfo=bindingInfoList[i];var device=bindingInfo["device"];var value=this.getValue(bindingInfo["dataField"]);var valuePath=bindingInfo["valuePath"];device.setValue(valuePath,value)}}};Data.prototype.getValues=function(){var values={};var keys=Object.keys(this);for(var i=0,len=keys.length;i<len;i++){if(keys[i]!="id"&&keys[i]!="__boundDevices"&&keys[i]!="__boundWidgets"&&keys[i]!="__initialValues"&&keys[i]!="__isBackward"&&typeof this[keys[i]]!=="function"){values[keys[i]]=JSON.parse(JSON.stringify(this[keys[i]]))}}return values};Data.prototype.getValue=function(path){if(this.__isBackward){if(!path.startsWith("data."))path="data."+path}var value=this;var arrPath=path.split(".");for(var i=0,len=arrPath.length;i<len;i++){if(value[arrPath[i]]!==undefined){value=value[arrPath[i]]}else{return}}return value};Data.prototype.__getValueWithConverter=function(path){var fields=path.split("+")[0];var converter=Top.Util.namespace(path.split("+")[1]);var value=this.getValue(fields);if(typeof converter.convert==="function"){return converter.convert(value)}else{return value}};Data.prototype.getData=function(keys){return this[keys]};Data.prototype.setData=function(values){if(this.__isBackward){var keys=Object.keys(values);for(var i=0,len=keys.length;i<len;i++){this["data"][keys[i]]=values[keys[i]]}this.__updateBoundWidgets("data."+keys);this.__updateBoundDevices("data."+keys)}else if(arguments.length===2&&typeof arguments[0]==="string"&&typeof arguments[1]==="object"){this.setValue(arguments[0],arguments[1])}else{this.setValues(values)}this.__updateRelationsBinding()};Data.prototype.setValues=function(values){var keys=Object.keys(values);for(var i=0,len=keys.length;i<len;i++){if(keys[i]!="id"&&keys[i]!="__boundDevices"&&keys[i]!="__boundWidgets"&&keys[i]!="__initialValues"){this[keys[i]]=values[keys[i]]}}this.__updateBoundWidgets(keys);this.__updateBoundDevices(keys);this.__updateRelationsBinding()};Data.prototype.setValue=function(path,value,__fromWidgetId,__isFromDevice){if(this.__isBackward&&!path.startsWith("data.")){path="data."+path}var arrPath=path.split(".");var base=this;for(var i=0,len=arrPath.length-1;i<len;i++){base=base[arrPath[i]]=base[arrPath[i]]||{}}base[arrPath[len]]=value;this.__updateBoundWidgets(path,__fromWidgetId);if(!__isFromDevice)this.__updateBoundDevices(path);this.__updateRelationsBinding()};Data.prototype.addValue=function(path,value){if(this.__isBackward&&!path.startsWith("data.")){path="data."+path}var arrPath=path.split(".");var base=this;for(var i=0,len=arrPath.length-1;i<len;i++){base=base[arrPath[i]]=base[arrPath[i]]||{}}if(Array.isArray(base[arrPath[len]])){if(value instanceof Top.Data){base[arrPath[len]].push(value.getValues())}else{base[arrPath[len]].push(value)}}this.__updateBoundWidgets(path);this.__updateBoundDevices(path);this.__updateRelationsBinding()};Data.prototype.removeValue=function(path,index){if(this.__isBackward&&!path.startsWith("data.")){path="data."+path}var arrPath=path.split(".");var base=this;for(var i=0,len=arrPath.length-1;i<len;i++){base=base[arrPath[i]]=base[arrPath[i]]||{}}if(this.__isBackward&&index>=0){base[arrPath[len]].splice(index,1)}else{if(Array.isArray(base)){base.splice(arrPath[len],1)}else{delete base[arrPath[len]]}}this.__updateBoundWidgets(path);this.__updateBoundDevices(path);this.__updateRelationsBinding()};Data.prototype.reset=function(path){if(typeof path==="string"){if(this.__isBackward&&!path.startsWith("data.")){path="data."+path}var arrPath=path.split(".");var base=this;var initialBase=JSON.parse(JSON.stringify(this.__initialValues));for(var i=0,len=arrPath.length-1;i<len;i++){base=base[arrPath[i]]=base[arrPath[i]]||{};initialBase=initialBase[arrPath[i]]=initialBase[arrPath[i]]||{}}base[arrPath[len]]=initialBase[arrPath[len]];this.__updateBoundWidgets(path);this.__updateBoundDevices(path)}else{var keys=Object.keys(this.__initialValues);for(var i=0,len=keys.length;i<len;i++){this[keys[i]]=this.__initialValues[keys[i]]}this.__updateBoundWidgets(keys);this.__updateBoundDevices(keys)}this.__updateRelationsBinding()};Data.prototype.update=function(path){if(typeof path==="string"){this.__updateBoundWidgets(path);this.__updateBoundDevices(path)}this.__updateRelationsBinding()};Data.prototype.setModel=function(field,modelId){var arrPath=field.split(".");var obj;if(arrPath.length==1){this.__modelInfo[arrPath[0]]={};this.__modelInfo[arrPath[0]]["modelId"]=modelId}else{if(this.__modelInfo[arrPath[0]])obj=this.__modelInfo[arrPath[0]];else{this.__modelInfo[arrPath[0]]={};obj=this.__modelInfo[arrPath[0]]}for(var i=1,len=arrPath.length-1;i<len;i++){if(obj[arrPath[i]]===undefined){obj[arrPath[i]]={}}obj=obj[arrPath[i]]}obj[arrPath[len]]={};obj[arrPath[len]]["modelId"]=modelId}};Data.prototype.getModel=function(){return this.__modelInfo};Data.prototype.setRelations=function(relations){this.relations=relations};Data.prototype.getRelations=function(){return this.relations};Data.prototype.getDataByRelations=function(relationsId){var relations=this.getRelationsById(relationsId);if(this[this.__toInstanceId(relationsId)]===undefined){this[this.__toInstanceId(relationsId)]=this.__makeDataByRelations(relations)}return this.__toInstanceId(relationsId)};Data.prototype.getRelationsById=function(relationsId){for(var i=0,len=this.relations.length;i<len;i++){if(this.relations[i].id===relationsId){return this.relations[i]}}};Data.prototype.__makeDataByRelations=function(relations){var relation=relations.Relation;var rootId=relation[0].parentId;var path=rootId;for(var i=0,len=relation.length;i<len;i++){if(rootId===relation[i].childId){rootId=relation[i].parentId;path=rootId.concat(".").concat(path)}else{path=path.concat(".").concat(relation[i].childId)}var _this=this;var parents=JSON.parse(JSON.stringify(this.getValue(rootId)));parents.forEach(function(parent){var children=_this.getValue(relation[i].childId);children.forEach(function(child){if(parent[relation[i].parentField]===child[relation[i].childField]){if(typeof parent[relation[i].childId]!=="object")parent[relation[i].childId]=[];parent[relation[i].childId].push(JSON.parse(JSON.stringify(child)))}})})}relations.rootId=rootId;this.__setRelationModel(path);this.__modelInfo[this.__toInstanceId(relations.id)]=this.getModel()[rootId];return parents};Data.prototype.__setRelationModel=function(path){var keys=path.split(".");var key=keys[0];this.setModel(key,this.getModel()[keys[0]].modelId);for(var i=1,len=keys.length;i<len;i++){key=key.concat(".").concat(keys[i]);this.setModel(key,this.getModel()[keys[i]].modelId)}};Data.prototype.getRootId=function(relationsId){for(var i=0,len=this.relations.length;i<len;i++){if(this.relations[i].id===relationsId){return this.relations[i].rootId}}};Data.prototype.__toInstanceId=function(relationsId){return"__relations__".concat(relationsId)};Data.prototype.__updateRelationsBinding=function(){var relations=this.getRelations();if(relations!==undefined){for(var i=0,len=relations.length;i<len;i++){var instanceId=this.__toInstanceId(relations[i].id);this[instanceId]=this.__makeDataByRelations(relations[i]);this.__updateBoundWidgets(instanceId)}}};Data.prototype.__clearBindingInfo=function(valuePath,widgetId){var parts=valuePath.split(".");var bindingPath=parts[0];var bindingInfoList=this.__boundWidgets[bindingPath];if(bindingInfoList===undefined)return;for(var i=bindingInfoList.length-1;i>=0;i--){if(bindingInfoList[i].widgetId===widgetId){bindingInfoList.splice(i,1)}}for(var j=1,len2=parts.length;j<len2;j++){bindingPath+="."+parts[j];bindingInfoList=this.__boundWidgets[bindingPath];for(var i=bindingInfoList.length-1;i>=0;i--){if(bindingInfoList[i].widgetId===widgetId){bindingInfoList.splice(i,1)}}}};Data.__modelList={};Data.createModel=function(packageName,id,dataFields){this.__modelList[id]=dataFields;this.createClass(packageName,id,Object.keys(dataFields))};Data.getDataModel=function(id){return this.__modelList[id]};Data.__classList={};Data.createClass=function(packageName,id,fieldNames){var paths=packageName.split(".");var path=paths[0];window[path]=window[path]||{};var pkg=window[path];for(var i=1,len=paths.length;i<len;i++){pkg[paths[i]]=pkg[paths[i]]||{};pkg=pkg[paths[i]]}pkg[id]={};pkg[id].class=id;for(var i=0,len=fieldNames.length;i<len;i++){pkg[id][fieldNames[i]]=""}this.__classList[id]=pkg[id]};Data.getClass=function(className){return this.__classList[className]};Data.toTreeNodes=function(origin,keyMap){if(!keyMap.hasOwnProperty("id")||!keyMap.hasOwnProperty("level"))return;var data=[];var lowData={};var rootLevel=1;for(var i=0,len=origin.length;i<len;i++){if(origin[i][keyMap.level]===0||origin[i][keyMap.level]==="0"){rootLevel=0;break}}for(i=0,len=origin.length;i<len;i++){var level=Number.isInteger(origin[i][keyMap.level])===true?origin[i][keyMap.level]:parseInt(origin[i][keyMap.level]);if(level===rootLevel){data.push({id:origin[i][keyMap.id],text:origin[i][keyMap.text]});this.__copyProperties(data[data.length-1],origin[i],keyMap)}else if(level>rootLevel){if(lowData[level]===undefined)lowData[level]=[];lowData[level].push(origin[i])}}var levels=Object.keys(lowData);for(i=0,len=levels.length;i<len;i++){var curData=lowData[levels[i]];for(var j=0,len2=curData.length;j<len2;j++){var parent=this.__searchObjectById(data,curData[j][keyMap.parentId]);if(parent!==undefined){this.__addChildNode(parent,curData[j],keyMap)}}}return data};Data.syncTreeNodes=function(nodes){for(var i=0;i<nodes.length;i++){syncChildren(nodes[i].children,nodes[i])}function syncChildren(childrenArr,upperNode){var childrenLength=childrenArr.length;var currentPath="";if(upperNode.path==""){currentPath=upperNode.id}else{currentPath=upperNode.path+"."+upperNode.id}var currentLevel=parseInt(upperNode.level)+1;for(var i=0;i<childrenLength;i++){var currentNode=childrenArr[i];currentNode.path=currentPath;currentNode.level=currentLevel;currentNode.parentId=upperNode.id;var childrenOfcurrentNode=currentNode.children;if(childrenOfcurrentNode!=null&&typeof childrenOfcurrentNode=="object"&&childrenOfcurrentNode.length>=1){syncChildren(childrenOfcurrentNode,currentNode)}}}};Data.__addChildNode=function(parent,child,keyMap){if(parent.children===undefined){parent.children=[]}if(child[keyMap.seq]){var index=parseInt(child[keyMap.seq])-1;parent.children.splice(index,0,{id:child[keyMap.id],text:child[keyMap.text]});var i=parent.children.length<=index?parent.children.length-1:index;this.__copyProperties(parent.children[i],child,keyMap)}else{parent.children.push({id:child[keyMap.id],text:child[keyMap.text]});this.__copyProperties(parent.children[parent.children.length-1],child,keyMap)}};Data.__searchObjectById=function(array,id){var result;for(var i=0,len=array.length;i<len;i++){if(array[i].id===id){return array[i]}else if(typeof array[i].children==="object"){result=this.__searchObjectById(array[i].children,id);if(result){return result}}}};Data.__copyProperties=function(target,source,keyMap){var keys=Object.keys(keyMap);for(var i=0,len=keys.length;i<len;i++){var key=keys[i];if(key!=="id"&&key!=="text"&&key!=="children"){target[keys[i]]=source[keyMap[keys[i]]]}}};return Data}();Top.Model=function(){Model.prototype=Object.create(Top.prototype);Model.prototype.constructor=Model;function Model(){}return Model}();Top.Model.Controller=function(){Controller.prototype=Object.create(Top.Model.prototype);Controller.prototype.constructor=Controller;function Controller(obj){Object.assign(this,obj)}Controller.create=function(obj){return new Controller(obj)};return Controller}();Top.DataController=function(){DataController.prototype=Object.create(Top.prototype);DataController.prototype.constructor=DataController;function DataController(obj){Object.assign(this,obj);var _this=this;var keys=Object.keys(this);for(var i=0,len=keys.length;i<len;i++){var name=keys[i];if(typeof this[name]=="object"){var data=this[name].data;this[name]=Top.Data.create({data:data,__isBackward:true})}}}DataController.create=function(obj){return new DataController(obj)};return DataController}();Top.Dom=function(){Dom.prototype=Object.create(Top.prototype);Dom.prototype.constructor=Dom;function Dom(){}Dom.selectById=function(id){if(id==="")return null;if(typeof Top.ContextMenu.get(id)==="string"){return this.__selectImpl(Top.ContextMenu.getWidgetById(id).template)}return this.__selectImpl(document.getElementById(id))};Dom.selectByTagName=function(tagName){var elements=document.getElementsByTagName(tagName);var widgets=[];if(elements.length>0){var l=elements.length;while(l--){widgets.unshift(Dom.__selectImpl(elements[l]))}}return widgets};Dom.select=function(selector){var elements=document.querySelectorAll(selector);var widgets=[];if(elements.length>0){var l=elements.length;while(l--){var widget=Dom.__selectImpl(elements[l]);if(widget)widgets.unshift(widget)}}return widgets};Dom.__selectImpl=function(element){if(!element||!Top.Util.__isTopWidget(element.tagName)){return null}if(element.tagName=="TOP-AJAX"){return element}var widget=Top.Widget.create(element.localName,undefined,element);return widget};Dom.appendToBody=function(widget){if(typeof widget==="string"){widget=this.selectById(widget)}var body=document.getElementsByTagName("body");body[0].appendChild(widget.template)};Dom.appendChild=function(parentId,widget){if(typeof widget==="string"){widget=this.selectById(widget)}var parentNode=document.getElementById(parentId);parentNode.appendChild(widget.template)};Dom.insertBefore=function(referId,widget){if(typeof widget==="string"){widget=this.selectById(widget)}var referNode=document.getElementById(referId);referNode.insertBefore(widget.template,referNode.childNodes[0])};Dom.remove=function(widgetId){document.getElementById(widgetId).remove()};return Dom}();Top.Ajax=function(){Ajax.prototype=Object.create(Top.prototype);Ajax.prototype.constructor=Ajax;function Ajax(){}Ajax.execute=function(url,settings){if(typeof url==="object"&&typeof settings==="undefined"){var settings=url;url=settings.url}var type=settings.type?settings.type:"get";var async=settings.async!==undefined?settings.async:true;var responseType=settings.dataType!==undefined?settings.dataType:"";var _success=settings.success;var _error=settings.error;var _complete=settings.complete;if(type.toLowerCase()==="get"&&settings.data){url+=Top.Ajax.toQueryString(settings.data)}var xhr=new XMLHttpRequest;xhr.open(type,url,async);if(async)xhr.responseType=responseType;xhr.onload=function(){if(xhr.status===200){if(typeof xhr.response==="string"&&!xhr.response.startsWith("<")&&typeof settings.response==="string"){var dataName=Top.Util.getDataName(settings.response);if(dataName){var dataObj=Top.Util.namespace(dataName);if(dataObj instanceof Top.Data){var path=settings.response.split(dataName+".")[1];dataObj.setValue(path,xhr.response)}}}if(typeof _success==="function")_success(xhr.response,xhr.status,xhr)}else{if(typeof _error==="function")_error(xhr,xhr.status)}if(typeof _complete==="function")_complete(xhr,xhr.status)};if(type.toLowerCase()==="post"&&settings.data){var data=typeof settings.data==="string"?settings.data:JSON.stringify(settings.data);var contentType=typeof settings.contentType==="string"?settings.contentType:"application/json";xhr.setRequestHeader("Content-Type",contentType);xhr.send(data)}else{xhr.send()}};Ajax.executeById=function(id){Top.Dom.selectById(id).execute()};Ajax.get=function(url,request,response,onSuccess,onFail){var settings={};settings.type="get";settings.data=request;settings.response=response;settings.success=onSuccess;settings.error=onFail;this.execute(url,settings)};Ajax.post=function(url,request,response,onSuccess,onFail){var settings={};settings.type="post";settings.data=request;settings.response=response;settings.success=onSuccess;settings.error=onFail;this.execute(url,settings)};Ajax.toQueryString=function(data){if(typeof data==="string"){return"?"+data}else if(typeof data==="object"){return"?"+$.param(data)}};return Ajax}();Top.Device=function(){Device.prototype=Object.create(Top.prototype);Device.prototype.constructor=Device;Device.prototype.id="";Device.prototype.__boundWidgets={};Device.prototype.__boundData={};function Device(obj){Object.assign(this,obj);this.__init();Top.Util.createGetterSetter(this);this.id=Top.Util.guid();this.__boundWidgets={};this.__boundData={}}Device.create=function(obj){return new Device(obj)};Device.prototype.__addBoundWidget=function(valuePath,widgetId,prop){var pathRoot=valuePath.split(".")[0];var bindingInfo={};bindingInfo.widgetId=widgetId;bindingInfo.property=prop;bindingInfo.valuePath=valuePath;if(this.__boundWidgets[pathRoot]===undefined)this.__boundWidgets[pathRoot]=[];this.__boundWidgets[pathRoot].push(bindingInfo)};Device.prototype.__addBoundData=function(valuePath,data,dataField){var pathRoot=valuePath.split(".")[0];var bindingInfo={};bindingInfo.data=data;bindingInfo.dataField=dataField;bindingInfo.valuePath=valuePath;if(this.__boundData[pathRoot]===undefined)this.__boundData[pathRoot]=[];this.__boundData[pathRoot].push(bindingInfo)};Device.prototype.__updateBoundWidgets=function(key){if(typeof key==="object"){for(var i=0,len=key.length;i<len;i++){this.__updateBoundWidgetsImpl(key[i])}}else{this.__updateBoundWidgetsImpl(key)}};Device.prototype.__updateBoundWidgetsImpl=function(key){if(this.__boundWidgets&&this.__boundWidgets[key]){var bindingInfoList=this.__boundWidgets[key];for(var i=0,len=bindingInfoList.length;i<len;i++){var bindingInfo=bindingInfoList[i];var widget=Top.Dom.selectById(bindingInfo["widgetId"]);var prop=bindingInfo["property"];var value=this.getValue(bindingInfo["valuePath"]);var obj={};obj[prop]=value;widget.setProperties(obj,false,true)}}};Device.prototype.__updateBoundData=function(key){if(typeof key==="object"){for(var i=0,len=key.length;i<len;i++){this.__updateBoundDataImpl(key[i])}}else{this.__updateBoundDataImpl(key)}};Device.prototype.__updateBoundDataImpl=function(key){if(this.__boundData&&this.__boundData[key]){var bindingInfoList=this.__boundData[key];for(var i=0,len=bindingInfoList.length;i<len;i++){var bindingInfo=bindingInfoList[i];var data=bindingInfo["data"];var dataField=bindingInfo["dataField"];var value=this.getValue(bindingInfo["valuePath"]);data.setValue(dataField,value,true)}}};Device.prototype.getValue=function(path){var arrPath=path.split(".");var value=this;for(var i=0,len=arrPath.length;i<len;i++){if(value[arrPath[i]]){value=value[arrPath[i]]}else{return}}return value};Device.prototype.setValue=function(path,value){var arrPath=path.split(".");var base=this;for(var i=0,len=arrPath.length-1;i<len;i++){base=base[arrPath[i]]=base[arrPath[i]]||{}}base[arrPath[len]]=value;this.__updateBoundWidgets(arrPath[0]);this.__updateBoundData(arrPath[0])};return Device}();Top.Device.RestAPI=function(){RestAPI.prototype=Object.create(Top.Device.prototype);RestAPI.prototype.constructor=RestAPI;RestAPI.prototype.host="";RestAPI.prototype.url="";RestAPI.prototype.dataType="JSON";RestAPI.prototype.sync=true;RestAPI.prototype.requestHeaderData="";RestAPI.prototype.requestBodyData="";RestAPI.prototype.status="";RestAPI.prototype.statusCode="";RestAPI.prototype.headerData="";RestAPI.prototype.responseBodyData="";RestAPI.prototype.onComplete=function(){};RestAPI.prototype.onSuccess=function(){};RestAPI.prototype.onFailure=function(){};function RestAPI(obj){Object.assign(this,obj)}RestAPI.create=function(obj){return new RestAPI(obj)};RestAPI.prototype.__init=function(){if(!this.host)this.host="";if(!this.url)this.url="";if(!this.dataType)this.dataType="JSON";if(!this.sync)this.sync=true;if(!this.requestHeaderData)this.requestHeaderData="";if(!this.requestBodyData)this.requestBodyData=""};RestAPI.prototype.get=function(){this.__ajax("GET")};RestAPI.prototype.post=function(){this.__ajax("POST")};RestAPI.prototype.put=function(){this.__ajax("PUT")};RestAPI.prototype.delete=function(){this.__ajax("DELETE")};RestAPI.prototype.__ajax=function(type){var __this=this;var settings={};settings.type=type;settings.dataType=this.dataType;settings.async=this.sync;settings.data=this.requestBodyData;settings.complete=function(jqXHR,textStatus){__this.onComplete(__this)};settings.success=function(data,textStatus,jqXHR){__this.setValue("responseBodyData",data);__this.setValue("statusCode",jqXHR.status);__this.onSuccess(__this)};settings.error=function(jqXHR,textStatus,errorThrown){__this.setValue("headerData","");__this.setValue("responseBodyData","");__this.setValue("statusCode",jqXHR.status);__this.onFailure(__this)};Top.Ajax(this.host+this.url,settings)};RestAPI.prototype.getDataType=function(){return this.dataType};RestAPI.prototype.getDeviceType=function(){return"RestAPI"};RestAPI.prototype.getHeaderData=function(){return this.headerData};RestAPI.prototype.getHost=function(){return this.host};RestAPI.prototype.getRequestBodyData=function(){return this.requestBodyData};RestAPI.prototype.getResponse=function(){return this.responseBodyData};RestAPI.prototype.getResponseBodyData=function(){return this.responseBodyData};RestAPI.prototype.getStatus=function(){return this.status};RestAPI.prototype.getStatusCode=function(){return this.statusCode};RestAPI.prototype.getUrl=function(){return this.url};RestAPI.prototype.isSync=function(){return this.sync};RestAPI.prototype.setDataType=function(dataType){this.dataType=dataType};RestAPI.prototype.setHeaderData=function(headerData){this.headerData=headerData};RestAPI.prototype.setHost=function(host){this.host=host};RestAPI.prototype.setRequestBodyData=function(requestBodyData){this.requestBodyData=requestBodyData};RestAPI.prototype.setStatus=function(status){this.status=status};RestAPI.prototype.setSync=function(sync){this.sync=sync};RestAPI.prototype.setUrl=function(url){this.url=url};return RestAPI}();Top.Device.FileChooser=function(){FileChooser.prototype=Object.create(Top.Device.prototype);FileChooser.prototype.constructor=FileChooser;FileChooser.prototype.id="";FileChooser.prototype.title="";FileChooser.prototype.windowId="";FileChooser.prototype.saveAs="";FileChooser.prototype.extFilter="";FileChooser.prototype.defaultExt="";FileChooser.prototype.defaultPath="";FileChooser.prototype.path="";FileChooser.prototype.responseString="";FileChooser.prototype.File=null;FileChooser.prototype.onFileChoose=function(){};function FileChooser(obj){Object.assign(this,obj)}FileChooser.create=function(obj){return new FileChooser(obj)};FileChooser.prototype.getDeviceType=function(){return"FileChooser"};FileChooser.prototype.getTitle=function(){return this.title};FileChooser.prototype.setTitle=function(title){this.title=title};FileChooser.prototype.getWindowId=function(){return this.windowId};FileChooser.prototype.setWindowId=function(windowId){this.windowId=windowId};FileChooser.prototype.getSaveAs=function(){return this.saveAs};FileChooser.prototype.setSaveAs=function(saveAs){this.saveAs=saveAs};FileChooser.prototype.getDefaultExt=function(){return this.defaultExt};FileChooser.prototype.setDefaultExt=function(defaultExt){this.defaultExt=defaultExt};FileChooser.prototype.getExtFilter=function(){return this.extFilter};FileChooser.prototype.setExtFilter=function(extFilter){this.extFilter=extFilter};FileChooser.prototype.getDefaultPath=function(){return this.defaultPath};FileChooser.prototype.setDefaultPath=function(defaultPath){this.defaultPath=defaultPath};FileChooser.prototype.getMultiple=function(){return this.multiple};FileChooser.prototype.setMultiple=function(multiple){this.multiple=multiple};FileChooser.prototype.getFolder=function(){return this.webkitdirectory};FileChooser.prototype.setFolder=function(folder){this.webkitdirectory=folder};FileChooser.prototype.getPath=function(){return this.path};FileChooser.prototype.setPath=function(path){this.path=path};FileChooser.prototype.getFile=function(){return this.file};FileChooser.prototype.setFile=function(file){this.file=file};FileChooser.prototype.getSrc=function(){return this.src};FileChooser.prototype.read=function(){var _this=this;var rABS=typeof FileReader!=="undefined"&&typeof FileReader.prototype!=="undefined"&&typeof FileReader.prototype.readAsBinaryString!=="undefined";if(_this.webkitdirectory===true){_this.folderName=_this.file[0].webkitRelativePath.split("/")[0]}for(var i=0;i<_this.file.length;i++){var file=_this.file[i];var reader=new FileReader;reader.onload=function(event){_this.src=event.target.result;_this.onFileRead(_this)};if(file!==undefined){if(file.name.substring(file.name.length,file.name.length-3)==="xls"||file.name.substring(file.name.length,file.name.length-3)==="csv"||file.name.substring(file.name.length,file.name.length-4)==="xlsx"){if(rABS)reader.readAsBinaryString(file);else reader.readAsArrayBuffer(file)}else{if(Top.Util.Browser.isIE()){if(file.size<5e7)reader.readAsDataURL(file);else reader.readAsArrayBuffer(file)}else{if(file.size<524288e3)reader.readAsDataURL(file);else reader.readAsBinaryString(file)}}}}};FileChooser.prototype.show=function(){var pageId=Top.App.getCurrentPage().id;var inputId=pageId.concat("_fileChooser");var rABS=typeof FileReader!=="undefined"&&typeof FileReader.prototype!=="undefined"&&typeof FileReader.prototype.readAsBinaryString!=="undefined";var input=document.getElementById(inputId);if(input===null){input=document.createElement("input")}input.id=inputId;input.style.display="none";input.type="file";input.accept=this.extFilter;input.multiple=this.multiple;if(!Top.Util.Browser.isIE()){input.webkitdirectory=this.folder}input.multiple=this.multiple;if(input.multiple!==true)input.multiple=input.folder;var _this=this;input.onchange=function(event){_this.path=this.value;_this.file=this.files;if(input.multiple===true){_this.path=_this.path.replace(_this.file[0].name,"")}if(input.webkitdirectory===true){
_this.folderName=_this.file[0].webkitRelativePath.split("/")[0]}var fileArray=new Array;for(var i=0;i<_this.file.length;i++){(function(file){var reader=new FileReader;reader.onload=function(event){_this.src=event.target.result;var fileFormat=_this.path.split(".")[_this.path.split(".").length-1];if(Top.Util.Browser.isIE()){fileFormat=file.name.split(".")[file.name.split(".").length-1]}if(fileFormat=="xlsx"||fileFormat=="xls"||fileFormat=="csv"){if(!rABS){var binary="";var bytes=new Uint8Array(reader.result);var length=bytes.byteLength;for(var i=0;i<length;i++){binary+=String.fromCharCode(bytes[i])}_this.src=binary}}if(input.multiple===true){var tmp=Object.assign({},_this);if(Top.Util.Browser.isIE()){tmp.path=_this.path.split(",")[0]+file.name}else{tmp.path=_this.path+file.name}var fileFormat=tmp.path.split(".")[tmp.path.split(".").length-1];if(fileFormat=="xlsx"||fileFormat=="xls"||fileFormat=="csv"){if(!rABS){var binary="";var bytes=new Uint8Array(reader.result);var length=bytes.byteLength;for(var i=0;i<length;i++){binary+=String.fromCharCode(bytes[i])}tmp.src=binary}}fileArray.push(tmp);if(fileArray.length===_this.file.length){_this.onFileChoose(fileArray)}}else{_this.onFileChoose(_this)}};if(file!==undefined){var fileFormat=file.name.split(".")[file.name.split(".").length-1];if(fileFormat=="xlsx"||fileFormat=="xls"||fileFormat=="csv"){if(rABS)reader.readAsBinaryString(file);else reader.readAsArrayBuffer(file)}else{if(Top.Util.Browser.isIE()){if(file.size<5e7)reader.readAsDataURL(file);else reader.readAsArrayBuffer(file)}else{if(file.size<524288e3)reader.readAsDataURL(file);else reader.readAsBinaryString(file)}}}})(_this.file[i])}document.getElementById(inputId).remove()};document.getElementById(pageId).appendChild(input);input.click()};return FileChooser}();Top.Controller=function(){Controller.prototype=Object.create(Top.prototype);Controller.prototype.constructor=Controller;function Controller(obj){Object.assign(this,obj)}Controller.map={};Controller.create=function(name,controller){if(typeof name==="object"&&controller===undefined){return Top.DataController.create(name)}else if(typeof name==="string"&&typeof controller==="object"){if(typeof this.get(name)==="object"){this.set(name,Object.assign(this.get(name),controller))}else{if(typeof controller.init==="function"){controller.__init=controller.init;delete controller.init}var controllerImpl=new Controller(controller);controllerImpl.__name=name;this.set(name,controllerImpl)}}else{console.error("Type error: Top.Controller.create(string, object)")}};Controller.onLoad=function(controller,callback){if(!controller.hasOwnProperty("__loadEvents")){controller.__loadEvents=[]}controller.__loadEvents.push(callback)};Controller.set=function(name,controller){this.map[name]=controller};Controller.get=function(name){return this.map[name]};Controller.setAppController=function(controller){Controller.appController=controller};Controller.getAppController=function(){return Controller.appController||window};Controller.prototype.__boundWidget=Object;Controller.prototype.__loadEvents=[];Controller.prototype.__initEvents=[];Controller.prototype.__loaded=false;Controller.prototype.__setBoundWidget=function(widgetId){Top.Controller.current=this.getName();if(widgetId===undefined){if(typeof this.__init==="function"){this.__init()}this.__callLoadEvents();this.__loaded=true;this.__callInitEvents()}else{var widget=Top.Dom.selectById(widgetId);var _this=this;var initOnWidgetAttach=function(){if(typeof _this.__init==="function"){_this.__init(widget)}_this.__callLoadEvents();_this.__loaded=true;_this.__callInitEvents()};if(widget&&widget.template&&widget.template.__isAttached===true){initOnWidgetAttach()}else{if(Top.events.onWidgetAttach[widgetId]===undefined){Top.events.onWidgetAttach[widgetId]=[]}Top.events.onWidgetAttach[widgetId].push(initOnWidgetAttach)}}};Controller.prototype.__callLoadEvents=function(){if(!this.hasOwnProperty("__loadEvents"))return;for(var i=0,len=this.__loadEvents.length;i<len;i++){this.__loadEvents[i]()}};Controller.prototype.__callInitEvents=function(){for(var i=0,len=this.__initEvents.length;i<len;i++){this.__initEvents[i]()}this.__initEvents=[]};Controller.prototype.onInit=function(callback){if(typeof callback==="function"){this.__initEvents.push(callback)}};Controller.prototype.isLoaded=function(){return this.__loaded};Controller.prototype.getName=function(){return this.__name};return Controller}();Top.Module=function(){Module.prototype=Object.create(Top.prototype);Module.prototype.constructor=Module;function Module(){}Module.__moduleList={};Module.__curName="";Module.create=function(module){this.__moduleList[this.__curName]=module};Module.load=function(name,callback){if(Top.modules[name]===undefined){console.error(name+" is not defined.")}else{if(this.__moduleList[name]===undefined){var _this=this;this.__curName=name;Top.Ajax.execute(Top.modules[name],{dataType:"script",cache:true,success:function(script){script;if(typeof callback==="function")callback(_this.__moduleList[name])}})}else{if(typeof callback==="function")callback(this.__moduleList[name])}}};return Module}();Top.Util=function(){Util.prototype=Object.create(Top.prototype);Util.prototype.constructor=Util;function Util(){}Util.guid=function(){return"zxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)})};Util.isTopData=function(strValue){if(strValue&&typeof strValue==="string"){var dataRoot=Top.Util.namespace(strValue.split(".")[0]);return typeof dataRoot.init==="function"}};Util.getFileExtension=function(fileName){return fileName.split(".").pop()};Util.getFileName=function(path){return path.split(/(\\|\/)/g).pop()};Util.namespace=function(string,widget){if(typeof string!=="string"){return null}else if(this.__isUrl(string)){return function(){Top.App.routeTo(string)}}else if(this.__isAction(string)){return this.__stringToAction(string)}else if(this.__isDeviceWithEvent(string)){return this.__stringToDeviceWithEvent(string)}else if(this.__isLogicWithParams(string)){return this.__stringToLogicWithParams(string)}else if(string.includes("(")&&string.includes(")")){return function(){eval(string)}}else{return this.__stringToObject(string,widget)}};Util.getDataName=function(path,widget){var parts=path.split(".");var dataName="";for(var i=0,len=parts.length;i<len;i++){if(dataName===""){dataName=dataName.concat(parts[i])}else{dataName=dataName.concat("."+parts[i])}if(Top.Util.namespace(dataName,widget)instanceof Top.Data){return dataName}}return""};Util.__isUrl=function(str){var IS_HTTP=/^(f|ht)tps?:\/\//i;return str.startsWith("/")||IS_HTTP.test(str)};Util.__isAction=function(str){var IS_ACTION=new RegExp("^\\(([a-zA-Z0-9_-]+)(%([\\x20-\\x7E]+))*\\)$");return IS_ACTION.test(str)};Util.__isDeviceWithEvent=function(str){var IS_DEVICE_WITH_EVENT=new RegExp("^\\{#([a-zA-Z0-9_-]+):*([a-zA-Z0-9_-]+)\\(\\)\\}$");return IS_DEVICE_WITH_EVENT.test(str)};Util.__isLogicWithParams=function(str){return str.includes("%")};Util.__stringToLogicWithParams=function(str){var parts=str.split("%");var obj={};obj.fn=this.__searchObject(window,parts[0]);obj.params=[];for(var i=1,len=parts.length;i<len;i++){obj.params.push(parts[i])}return obj};Util.__stringToAction=function(str){var parts=str.replace("(","").replace(")","").split("%");var len=parts.length;var action=window[parts[0]];if(len>1){var arg=[];for(var i=1;i<len;i++){arg.push(parts[i])}function fn(){action(arg)}return fn}else{return action}};Util.__stringToDeviceWithEvent=function(str){var parts=str.replace("{#","").replace("}","").replace("()","").split(":");var obj={};obj.type="device";obj.device=window[parts[0]];obj.fn=parts[1];return obj};Util.__stringToObject=function(str,widget){if(widget!==undefined&&typeof widget.getController==="function"){var controller=widget.getController();if(controller){var object=this.__searchObject(controller,str);if(object!==undefined){return object}else{return this.__stringToObject(str,widget.getParent())}}else{var object=this.__searchObject(Top.Controller.getAppController(),str);if(object!==undefined){return object}else{return this.__searchObject(window,str)}}}else{var object=this.__searchObject(Top.Controller.getAppController(),str);if(object!==undefined){return object}else{return this.__searchObject(window,str)}}};Util.__searchController=function(widget){var controller=widget.getController();while(controller===undefined){if(typeof widget.getController!=="function")return undefined;widget=widget.getParent();if(widget===undefined||typeof widget!=="object"){return Top.Controller.getAppController()}if(Top.Util.Browser.isIE()){controller=Top.Controller.get(widget.getAttribute("controller"))}else{controller=Top.Controller.get(widget.controller)}}return controller};Util.__searchObject=function(base,str){var object=base;var parts=str.split(".");for(var i=0;i<parts.length;i++){if(typeof object[parts[i]]==="undefined"){return undefined}object=object[parts[i]]}return object};Util.createGetterSetter=function(object){if(object.__createdGetterSetter===true)return object;var keys=Object.keys(object);for(var i=0,len=keys.length;i<len;i++){object["get"+this.capitalizeFirstLetter(keys[i])]=function(key){return function(){return this[key]}}(keys[i]);object["set"+this.capitalizeFirstLetter(keys[i])]=function(key){return function(value){object[key]=value;var repo=Top.Util.namespace(this.__repoId);repo.update(this.__insId+"."+key)}}(keys[i]);if(typeof object[keys[i]]==="object"){this.createGetterSetter(object[keys[i]])}}object.__createdGetterSetter=true;return object};Util.capitalizeFirstLetter=function(string){return string.charAt(0).toUpperCase()+string.slice(1)};Util.toCamelCase=function(string){return string.replace(/-([a-z])/g,function(g){return g[1].toUpperCase()})};Util.toUnderscore=function(string){return string.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase()})};Util.toDash=function(string){return string.replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()})};Util.__isStyleProperty=function(property){var styleRegexp=/^(opacity|background|backgroundColor|backgroundImage|tileMode|maxWidth|minWidth|maxHeight|minHeight|lineHeight|padding|margin|visible|display|zIndex|float|position|horizontalAlignment|verticalAlignment|layoutHorizontalAlignment|layoutVerticalAlignment|layoutHeight|layoutWidth|layoutTop|layoutLeft|layoutRight|layoutBottom|borderWidth|borderBottomWidth|borderLeftWidth|borderRightWidth|borderTopWidth|borderStyle|borderColor|borderRadius|verticalScroll|horizontalScroll)$/;return styleRegexp.test(property)};Util.__measureTextSize=function(pText,pFontSize,pStyle){var lDiv=document.createElement("div");document.body.appendChild(lDiv);if(pStyle!=null){lDiv.style=pStyle}lDiv.style.fontSize=""+pFontSize+"px";lDiv.style.position="absolute";lDiv.style.left=-1e3;lDiv.style.top=-1e3;lDiv.innerHTML=pText;var lResult={width:lDiv.clientWidth,height:lDiv.clientHeight};document.body.removeChild(lDiv);lDiv=null;return lResult};Util.__isTopWidget=function(tagName){if(tagName){var name=tagName.toLowerCase()}return/^TOP-[a-zA-Z]*/.test(tagName)&&tagName!=="TOP-WIDGETITEM"&&tagName!=="TOP-LISTHEADER"&&tagName!=="TOP-ROWITEM"&&tagName!=="TOP-COLUMNITEM"&&tagName!=="TOP-TABLEHEADER"&&tagName!=="TOP-HEADERCOLUMN"||topWidgets[name]!==undefined&&topWidgets[name].isCustomType===true};Util.__getControllerPaths=function(strLayout){var matched=strLayout.match(/ controller-path="([^"]*)"/);if(matched){return matched[1].split(",")}else{return undefined}};Util.__getRawValue=function(str){if(str.startsWith("@raw")){str=str.split("?")[0];var id=str.substr(str.indexOf("/")+1);return Top.RawManager.get(id.split(".")[0])}else{return str}};Util.__isBooleanTrue=function(value){if(typeof value==="boolean"){return value}else if(typeof value==="string"){if(value==="true")return true;else if(value==="false")return false}return Boolean(value)};return Util}();Top.Util.Browser=function(){Browser.prototype=Object.create(Top.Util.prototype);Browser.prototype.constructor=Browser;function Browser(){}Browser.isOpera=function(){return!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0};Browser.isFirefox=function(){return typeof InstallTrigger!=="undefined"};Browser.isSafari=function(){return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0};Browser.isIE=function(){return false||!!document.documentMode};Browser.isEdge=function(){return!this.isIE()&&!!window.StyleMedia};Browser.isChrome=function(){return!!window.chrome&&!!window.chrome.webstore};Browser.isBlink=function(){return(this.isChrome()||this.isOpera())&&!!window.CSS};Browser.getIEVersion=function(){var word;var agent=navigator.userAgent.toLowerCase();if(navigator.appName=="Microsoft Internet Explorer")word="msie ";else if(agent.search("trident")>-1)word="trident/.*rv:";else if(agent.search("edge/")>-1)word="edge/";else return 100;var reg=new RegExp(word+"([0-9]{1,})(\\.{0,}[0-9]{0,1})");if(reg.exec(agent)!=null)return parseFloat(RegExp.$1+RegExp.$2);return 100};return Browser}();Top.i18n=function(){i18n.prototype=Object.create(Top.prototype);i18n.prototype.constructor=i18n;function i18n(){}i18n.map={};i18n.__settings={};i18n.__loadEvents=[];i18n.__loaded=false;i18n.__boundWidgets=[];i18n.load=function(settings){this.__cntLoad=0;if(Array.isArray(settings)){for(var i=0,len=settings.length;i<len;i++){this.__loadImpl(settings[i],len)}}else{this.__loadImpl(settings,1)}};i18n.__loadImpl=function(settings,length){if(typeof settings==="object"){if(typeof this.__settings.name!=="string"&&typeof settings.name!=="string"){console.error("Top.i18n.load: name(string) is not defined.");return}if(typeof this.__settings.path!=="string"&&typeof settings.path!=="string"){settings.path=""}Object.assign(this.__settings,settings);if(typeof this.__settings.language!=="string"&&typeof settings.language!=="string"){var url=this.__settings.path+this.__settings.name+".json"}else if(typeof settings.language==="string"&&settings.language.length===0||settings.language.equals("default")){var url=this.__settings.path+this.__settings.name+".json"}if(this.__settings.checkDefaultLanguage===true||this.__settings.checkDefaultLanguage==="true"){this.__loadFile(this.__settings.path+this.__settings.name+".json",{name:this.__settings.name,language:"__default"});this.__settings.languageShort=this.__settings.language.split("_")[0];this.__loadFile(this.__settings.path+this.__settings.name+"_"+this.__settings.languageShort+".json",{name:this.__settings.name,language:this.__settings.languageShort})}var _this=this;if(!url)var url=this.__settings.path+this.__settings.name+"_"+this.__settings.language+".json";this.__loadFile(url,{name:this.__settings.name,language:this.__settings.language,callback:function(){if(typeof _this.__settings.callback==="function")_this.__settings.callback();_this.__cntLoad++;if(_this.__cntLoad===length){_this.__loaded=true;_this.__callLoadEvents();_this.__updateWidgets()}}})}else{console.error("Type error: Top.i18n.load(object)")}};i18n.t=function(key){var value=this.__getValueByString(key);if(value===undefined){console.error('Top.i18n: "'+key+'" is not defined.');return""}if(arguments.length>1){for(var i=0,len=arguments.length;i<len;i++){value=value.replace("{"+i+"}",arguments[i+1])}}return value};i18n.onLoad=function(callback){if(typeof callback==="function"){if(this.isLoaded()){callback()}else{this.__loadEvents.push(callback)}}else{console.error("Type error: Top.i18n.onLoad(function)")}};i18n.isLoaded=function(){return this.__loaded};i18n.__addBoundWidget=function(widget){if(!this.__boundWidgets.includes(widget)){this.__boundWidgets.push(widget)}};i18n.__callLoadEvents=function(){for(var i=0,len=this.__loadEvents.length;i<len;i++){this.__loadEvents[i]()}};i18n.__updateWidgets=function(){for(var i=0,len=this.__boundWidgets.length;i<len;i++){if(typeof this.__boundWidgets[i].__updateI18n==="function")this.__boundWidgets[i].__updateI18n()}};i18n.__loadFile=function(url,settings){var _this=this;Top.Ajax.execute(url,{async:false,success:function(data){Object.assign(_this.map,JSON.parse(data))},complete:function(){if(typeof settings.callback==="function")settings.callback()}})};i18n.__getValueByString=function(str){str=str.replace(/\[(\w+)\]/g,".$1");str=str.replace(/^\./,"");var a=str.split(".");var o=this.map;for(var i=0,n=a.length;i<n;++i){var k=a[i];if(k in o){o=o[k]}else{return undefined}}return o};i18n.set=function(obj){this.map=obj;this.__updateWidgets()};i18n.get=function(){return this.map};i18n.__clearBoundWidget=function(){i18n.__boundWidgets=[]};return i18n}();Top.LiveReload=function(){LiveReload.prototype=Object.create(Top.prototype);LiveReload.prototype.constructor=LiveReload;function LiveReload(obj){Object.assign(this,obj);if(!(this.WebSocket=window.WebSocket||window.MozWebSocket)){console.error("LiveReload disabled because the browser does not seem to support web sockets");return}this.uri="ws"+(this.options.https?"s":"")+"://"+this.options.host+":"+this.options.port+"/livereload"}LiveReload.create=function(obj){return new LiveReload(obj)};LiveReload.prototype.connect=function(){this.socket=new this.WebSocket(this.uri);var _this=this;this.socket.onopen=function(){_this.sendCommand({command:"hello",protocols:["http://livereload.com/protocols/official-6","http://livereload.com/protocols/official-7"]});_this.sendCommand({command:"info",url:window.location.href})};this.socket.onclose=function(){};this.socket.onmessage=function(e){_this.parseMessage(e.data)}};LiveReload.prototype.sendCommand=function(command){this.socket.send(JSON.stringify(command))};LiveReload.prototype.parseMessage=function(data){try{var message=JSON.parse(data)}catch(e){console.error("unparsable JSON",data)}switch(message.command){case"reload":this.reload(message);break;case"alert":this.alert(message);break}};LiveReload.prototype.reload=function(message){if(message.path.match(/\.html$/i)){var fileName=Top.Util.getFileName(message.path);if(fileName==="index.html"||this.__isCurrentPageFile(fileName)){this.reloadPage()}}else{this.reloadPage()}};LiveReload.prototype.reloadPage=function(){window.document.location.reload()};LiveReload.prototype.alert=function(message){alert(message.message)};LiveReload.prototype.__isCurrentPageFile=function(fileName){return Top.App.getPageIdBySrc(fileName)===Top.App.getCurrentPage().id};return LiveReload}();Top.DrawableManager=function(){DrawableManager.prototype=Object.create(Top.prototype);DrawableManager.prototype.constructor=DrawableManager;function DrawableManager(){}DrawableManager.__map={};DrawableManager.create=function(obj){Object.assign(DrawableManager.__map,obj)};DrawableManager.get=function(id){return DrawableManager.__map[id]};return DrawableManager}();Top.RawManager=function(){RawManager.prototype=Object.create(Top.prototype);RawManager.prototype.constructor=RawManager;function RawManager(){}RawManager.__map={};RawManager.create=function(obj){var keys=Object.keys(obj);var newObj={};for(var i=0,len=keys.length;i<len;i++){newObj[keys[i].split(".")[0]]=obj[keys[i]]}Object.assign(RawManager.__map,newObj)};RawManager.get=function(id){return RawManager.__map[id]};return RawManager}();Top.ValuesManager=function(){ValuesManager.prototype=Object.create(Top.prototype);ValuesManager.prototype.constructor=ValuesManager;function ValuesManager(){}ValuesManager.__map={strings:{},colors:{},dimens:{}};ValuesManager.create=function(type,obj){Object.assign(ValuesManager.__map[type],obj)};ValuesManager.get=function(type,id){return ValuesManager.__map[type][id]};return ValuesManager}();Top.ContextMenu=function(){ContextMenu.prototype=Object.create(Top.prototype);ContextMenu.prototype.constructor=ContextMenu;function ContextMenu(){}ContextMenu.__widget={};ContextMenu.__map={};ContextMenu.create=function(obj){Object.assign(ContextMenu.__map,obj)};ContextMenu.get=function(id){return ContextMenu.__map[id]};ContextMenu.setWidget=function(widget){this.__widget=widget};ContextMenu.getDom=function(){return this.__widget};ContextMenu.getWidgetById=function(id){this.__widget.setProperties({id:id,items:this.get(id)});return this.__widget};return ContextMenu}();Top.Dialog=function(){Dialog.prototype=Object.create(Top.prototype);Dialog.prototype.constructor=Dialog;function Dialog(){}Dialog.__map={};Dialog.create=function(id,props){this.__map[id]=props};Dialog.init=function(){var ids=Object.keys(this.__map);for(var i=0,len=ids.length;i<len;i++){var props=this.__map[ids[i]];props.id=ids[i];var dialog=Top.Widget.create("top-dialog",props);Top.App.getCurrentPage().template.appendChild(dialog.template);_callCallback(dialog.template,"attached")}};return Dialog}();Top.Notification=function(){Notification.prototype=Object.create(Top.prototype);Notification.prototype.constructor=Notification;function Notification(){}Notification.__map={};Notification.create=function(id,props){this.__map[id]=props};Notification.init=function(){var ids=Object.keys(this.__map);for(var i=0,len=ids.length;i<len;i++){var notification=Top.Widget.create("top-notification");var props=this.__map[ids[i]];props.id=ids[i];notification.setProperties(props);Top.App.getCurrentPage().template.appendChild(notification.template);_callCallback(notification.template,"attached")}};return Notification}();window.addEventListener("popstate",function(event){Top.App.closeDialogs();if(event.state&&event.state.path){Top.App.__routeReplace(event.state.path)}else if(location.hash){Top.App.__routeReplace(location.hash.replace("#!",""))}else if(location.hash===""){Top.App.__routeReplace()}});if(!String.prototype.startsWith){String.prototype.startsWith=function(searchString,position){position=position||0;return this.substr(position,searchString.length)===searchString}}if(!String.prototype.endsWith){String.prototype.endsWith=function(searchString,position){var subjectString=this.toString();if(typeof position!=="number"||!isFinite(position)||Math.floor(position)!==position||position>subjectString.length){position=subjectString.length}position-=searchString.length;var lastIndex=subjectString.indexOf(searchString,position);return lastIndex!==-1&&lastIndex===position}}if(!String.prototype.includes){String.prototype.includes=function(search,start){"use strict";if(typeof start!=="number"){start=0}if(start+search.length>this.length){return false}else{return this.indexOf(search,start)!==-1}}}if(!String.prototype.equals){String.prototype.equals=function(str){return this.toString()===str}}String.prototype.replaceAt=function(index,character){return this.substr(0,index)+character+this.substr(index+character.length)};if(typeof Object.assign!="function"){(function(){Object.assign=function(target){"use strict";if(target===undefined||target===null){throw new TypeError("Cannot convert undefined or null to object")}var output=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!==undefined&&source!==null){for(var nextKey in source){if(source.hasOwnProperty(nextKey)){output[nextKey]=source[nextKey]}}}}return output}})()}if(!Array.prototype.includes){Array.prototype.includes=function(searchElement){"use strict";if(this==null){throw new TypeError("Array.prototype.includes called on null or undefined")}var O=Object(this);var len=parseInt(O.length,10)||0;if(len===0){return false}var n=parseInt(arguments[1],10)||0;var k;if(n>=0){k=n}else{k=len+n;if(k<0){k=0}}var currentElement;while(k<len){currentElement=O[k];if(searchElement===currentElement||searchElement!==searchElement&&currentElement!==currentElement){return true}k++}return false}}if(!Array.prototype.fill){Object.defineProperty(Array.prototype,"fill",{value:function(value){if(this==null){throw new TypeError("this is null or not defined")}var O=Object(this);var len=O.length>>>0;var start=arguments[1];var relativeStart=start>>0;var k=relativeStart<0?Math.max(len+relativeStart,0):Math.min(relativeStart,len);var end=arguments[2];var relativeEnd=end===undefined?len:end>>0;var final=relativeEnd<0?Math.max(len+relativeEnd,0):Math.min(relativeEnd,len);while(k<final){O[k]=value;k++}return O}})}if(!Array.from){Array.from=function(){var toStr=Object.prototype.toString;var isCallable=function(fn){return typeof fn==="function"||toStr.call(fn)==="[object Function]"};var toInteger=function(value){var number=Number(value);if(isNaN(number)){return 0}if(number===0||!isFinite(number)){return number}return(number>0?1:-1)*Math.floor(Math.abs(number))};var maxSafeInteger=Math.pow(2,53)-1;var toLength=function(value){var len=toInteger(value);return Math.min(Math.max(len,0),maxSafeInteger)};return function from(arrayLike){var C=this;var items=Object(arrayLike);if(arrayLike==null){throw new TypeError("Array.from requires an array-like object - not null or undefined")}var mapFn=arguments.length>1?arguments[1]:void undefined;var T;if(typeof mapFn!=="undefined"){if(!isCallable(mapFn)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){T=arguments[2]}}var len=toLength(items.length);var A=isCallable(C)?Object(new C(len)):new Array(len);var k=0;var kValue;while(k<len){kValue=items[k];if(mapFn){A[k]=typeof T==="undefined"?mapFn(kValue,k):mapFn.call(T,kValue,k)}else{A[k]=kValue}k+=1}A.length=len;return A}}()}(function(arr){arr.forEach(function(item){if(item.hasOwnProperty("remove")){return}Object.defineProperty(item,"remove",{configurable:true,enumerable:true,writable:true,value:function remove(){if(this.parentNode!==null)this.parentNode.removeChild(this)}})})})([Element.prototype,CharacterData.prototype,DocumentType.prototype]);if(window.NodeList&&!NodeList.prototype.forEach){NodeList.prototype.forEach=function(callback,argument){argument=argument||window;for(var i=0;i<this.length;i++){callback.call(argument,this[i],i,this)}}}if(!("remove"in Element.prototype)){Element.prototype.remove=function(){if(this.parentNode){this.parentNode.removeChild(this)}}}Number.isInteger=Number.isInteger||function(value){return typeof value==="number"&&isFinite(value)&&Math.floor(value)===value};(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent})();if(Array.prototype.equals)console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code.");Array.prototype.equals=function(array){if(!array)return false;if(this.length!=array.length)return false;for(var i=0,l=this.length;i<l;i++){if(this[i]instanceof Array&&array[i]instanceof Array){if(!this[i].equals(array[i]))return false}else if(this[i]!=array[i]){return false}}return true};Object.defineProperty(Array.prototype,"equals",{enumerable:false});function isEquivalent(a,b){var aProps=Object.getOwnPropertyNames(a);var bProps=Object.getOwnPropertyNames(b);if(aProps.length!=bProps.length){return false}for(var i=0;i<aProps.length;i++){var propName=aProps[i];if(a[propName]!==b[propName]){return false}}return true}jQuery.fn.hasOverflown=function(){var res;var vwidth;var text=this.attr("value");if(text==undefined||text==""){return}if(text)text=text.replace(/\s/g,"&nbsp");var cont=$("<div>"+text+"</div>").css("display",this.css("none")).css("z-index","-50").css("position","absolute").css("font-family",this.css("font-family")).css("font-size",this.css("font-size")).css("font-weight",this.css("font-weight")).appendTo("body");vwidth=cont.width();cont.remove();res=vwidth>this.width();return res};Top.Loader=function(){Loader.prototype=Object.create(Top.prototype);Loader.prototype.constructor=Loader;function Loader(){}Loader.start=function(settings){if(this.__loadingCount===undefined)this.__loadingCount=0;if(this.__loadingCount===0){if(this.__id===undefined)this.__id=Top.Util.guid();this.__isLoading=true;if(typeof settings==="object"){var size=settings.size;var timeout=parseInt(settings.timeout);if(typeof timeout==="number"){setTimeout(function(){Top.Loader.stop()},timeout)}this.__onStop=settings.stop;if(typeof settings.parentId==="string"){var parent=Top.Dom.selectById(settings.parentId).getElement();if(this.__isLoadingWithLayout===undefined)this.__isLoadingWithLayout={};if(this.__isLoadingWithLayout[settings.parentId]===true)return;this.__isLoadingWithLayout[settings.parentId]=true}else{var parent=document.body;this.__isLoading=true}}else{var size=settings}if(parent){parent.insertAdjacentHTML("beforeend","<div class='top-loader-overlay' style='font-size:0;height:100%;'><ul class='top-loader "+size+"' style='position:absolute;'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul></div>");if(typeof settings.layout==="function"){settings.layout(parent.querySelector(".top-loader-overlay"))}}else{var page=Top.App.getCurrentPage();var overlayHeight=page!=null?page.template.__height+"px":"100%";var loaderTop=size==="large"?"calc(50% - 24px)":"calc(50% - 6px)";if(document.body)document.body.insertAdjacentHTML("beforeend","<div id='"+this.__id+"' class='top-loader-overlay' style='font-size:0;height:"+overlayHeight+";position:fixed;'><ul class='top-loader "+size+"' style='position:fixed;top:"+loaderTop+";'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul></div>")}}this.__loadingCount++};Loader.stop=function(force){if(typeof force==="object"){this.__stopWithSettings(force)}else{if(force===true){this.__loadingCount=0}else{this.__loadingCount--}if(this.__loadingCount===0){this.__isLoading=false;var l=document.getElementById(this.__id);if(Top.Util.Browser.isIE()){if(l)l.removeNode(true)}else{if(l)l.remove()}if(typeof this.__onStop==="function")this.__onStop()}else if(this.__loadingCount<0){this.__loadingCount=0}}};Loader.__stopWithSettings=function(settings){if(typeof settings.parentId==="string"&&this.__isLoadingWithLayout&&this.__isLoadingWithLayout[settings.parentId]===true){this.__isLoadingWithLayout[settings.parentId]=false;var parent=Top.Dom.selectById(settings.parentId).getElement();if(parent.querySelector(".top-loader-overlay")){parent.querySelector(".top-loader-overlay").remove()}if(typeof this.__onStop==="function")this.__onStop()}};Loader.isLoading=function(){return this.__isLoading};return Loader}();Top.EventManager=function(){EventManager.prototype=Object.create(Top.prototype);EventManager.prototype.constructor=EventManager;EventManager.prototype.events={};function EventManager(){}EventManager.on=function(event,topDom,selector,callback){var id=topDom.id;if(typeof topDom==="string")id=topDom;if(!this.prototype.events[event]){this.__addEvent(event,callback);this.prototype.events[event]={}}if(this.prototype.events[event]!==undefined){if(this.prototype.events[event][id]===undefined){this.prototype.events[event][id]={}}if(typeof selector==="function"){callback=selector;selector=id}this.prototype.events[event][id][selector]=callback}};EventManager.__findEvent=function(e){var events=Top.EventManager.prototype.events;var event=$.extend({},e);e=undefined;event.top_stop_propagation=false;event.stopPropagation=function(){this.top_stop_propagation=true};if(!events[event.type]){return}var dom=Top.EventManager.__findTopDom(event.target);if(dom===false)return false;if(events[event.type][dom.id]!==undefined){for(var tag in events[event.type][dom.id]){var widgets=Top.Dom.selectById(dom.id).template.querySelectorAll(tag);for(var i=0;i<widgets.length;i++){var widget=widgets[i];if(widget.isEqualNode(event.target)){var callback=events[event.type][dom.id][tag];callback(event)}}}}if(event.top_stop_propagation===false&&event.path.length>1){event.target=event.path[1];if(event.target.tagName.startsWith("TOP")&&Top.EventManager.flag===false){Top.EventManager.flag=true;Top.EventManager.__setLastEvent(event.target)}event.path.shift();Top.EventManager.__findEvent(event)}};EventManager.__findKeyEvent=function(e,lastEvent){
if(lastEvent===undefined)var lastEvent=Top.EventManager.lastEvent;var event=$.extend({},e);e=undefined;event.top_stop_propagation=false;event.stopPropagation=function(){this.top_stop_propagation=true};var events=Top.EventManager.prototype.events;if(lastEvent&&events[event.type][lastEvent.id]!==undefined){event.target=lastEvent;var callback=events[event.type][lastEvent.id][lastEvent.id];callback(event)}if(event.top_stop_propagation===false){var dom=EventManager.__findTopDom(lastEvent.parentNode);if(dom===false)return;EventManager.__findKeyEvent(event,dom)}};EventManager.off=function(event,topDom,selector){var id=topDom.id;if(typeof topDom==="string")id=topDom;var events=Top.EventManager.prototype.events;if(!events[event])return;if(!events[event][id])return;if(!events[event][id][selector])return;delete events[event][id][selector];var flag=false;for(var tmp in events[event][id]){flag=true;break}if(flag===false)delete events[event][id];var flag=false;for(var tmp in events[event]){flag=true;break}if(flag===false){delete events[event];document.removeEventListener(event)}};EventManager.__findTopDom=function(dom){if(dom===null||dom.tagName===undefined)return false;if(dom.tagName.startsWith("TOP")){return dom}return this.__findTopDom(dom.parentNode)};EventManager.__addEvent=function(type,callback){Top.EventManager.flag=false;if(type.startsWith("key"))document.addEventListener(type,this.__findKeyEvent);else document.addEventListener(type,this.__findEvent);Top.EventManager.flag=false};EventManager.__setLastEvent=function(target){Top.EventManager.lastEvent=target};return EventManager}();Top.Excel=function(){Excel.prototype=Object.create(Top.prototype);Excel.prototype.constructor=Excel;function Excel(){}Excel.import=function(device,header,callback){var data=device.src;var workbook=XLSX.read(data,{type:"binary"});var firstSheet=workbook.SheetNames[0];var workSheet=workbook.Sheets[firstSheet];var XL_row_object=XLSX.utils.sheet_to_row_object_array(workSheet);if(header!==null||header!==undefined){XL_row_object=this.convertKey(XL_row_object,header)}callback(XL_row_object)};Excel.convertKey=function(XL_row_object,header){var keys=Object.keys(XL_row_object[0]);var tmpArray=new Array;for(var i=0;i<XL_row_object.length;i++){var tmpInfo=new Object;for(var j=0;j<keys.length;j++)tmpInfo[header[j]]=XL_row_object[i][keys[j]];tmpArray.push(tmpInfo)}return tmpArray};Excel.export=function(id,booktype,pageId,tableData){if(pageId===undefined)pageId=Top.App.getCurrentPage().id;var table=Top.Dom.selectById(pageId).getElement("#"+id)[0];table.complete({syncData:false});table.sync();if(booktype==undefined)booktype="xlsx";if(booktype==="xls"){alert("xls format is not yet spported");return}if(booktype!="xlsx"&&booktype!="csv"&&booktype!="xls"){console.warn(booktype+" is unexpected excel type!(xlsx, csv, xls)");return}if(tableData){var data=this.__tableDataToJson(table,tableData)}else if(table.paginate){var data=this.__tableDataToJson(table,table.data)}else if(table.virtualScroll){var data=this.__tableDataToJson(table,table.backupdata)}else{var data=this.__tableToJson(table)}var ws_name="Sheet1";if(booktype=="csv"){this.__exportCsv(data);return}var wb=new Object;wb.SheetNames=[];wb.Sheets={};var shadowBody=table.querySelector("tbody");var children=shadowBody.children;var ws=this.__sheet_from_array_of_arrays(data,children);wb.SheetNames.push(ws_name);wb.Sheets[ws_name]=ws;if(booktype=="xls")booktype="xlml";var wopts={bookType:booktype,bookSST:false,type:"binary",cellStyles:"true"};if(booktype=="xlml")booktype="xls";var wbout=XLSX.write(wb,wopts);saveAs(new Blob([this.__s2ab(wbout)],{type:"application/octet-stream"}),"top-tableview_to_excel."+booktype)};Excel.__exportCsv=function(data){var csvString="";for(var i=0;i<data.length;i++){for(var j=0;j<Object.keys(data[i]).length;j++){csvString+='"'+data[i][j]+'"';if(j<Object.keys(data[i]).length-1)csvString+=","}csvString+="\r\n"}var blob=new Blob(["\ufeff"+csvString],{type:"data:text/csv;charset=utf-8,\ufeff"});var encodedUri=encodeURI(csvString);if(Top.Util.Browser.isIE()){window.navigator.msSaveOrOpenBlob(blob,"top-tableview_to_csv.csv")}else{var link=document.createElement("a");link.setAttribute("href","data:text/csv;charset=utf-8,\ufeff"+encodedUri);link.setAttribute("download","report.csv");link.click()}};Excel.__tableDataToJson=function(table,tableData){var rowSpanDummyString="";var colSpanDummyString="";var array=[];var numOfHeader=1;var ths=table.querySelectorAll(".top-tableview-scrollHead .head-cell:not(.checkable)");var headerRows=table.querySelectorAll(".top-tableview-scrollHead .head-row");for(var i=0,len=headerRows.length;i<len;i++){array[i]=[];var row=headerRows[i];var colOffset=0;var temp=[];for(var j=0,len2=row.cells.length;j<len2;j++){var cell=row.cells[j];if(cell.getAttribute("value")!=null){array[i].push(cell.getAttribute("value"))}else if(cell.innerText!=null){array[i].push(cell.innerText)}if(cell.getAttribute("colspan")>1){for(var k=1,len3=cell.getAttribute("colspan");k<len3;k++){array[i].splice(j+k+colOffset,0,colSpanDummyString)}colOffset+=parseInt(cell.getAttribute("colspan"))}if(parseInt(cell.getAttribute("rowspan"))>numOfHeader){numOfHeader=parseInt(cell.getAttribute("rowspan"))}}}if(numOfHeader===2){var rowOffset=0;var row0=headerRows[0];for(var i=0,len=row0.cells.length;i<len;i++){if(row0.cells[i].getAttribute("rowspan")>1){array[1].splice(i+rowOffset,0,rowSpanDummyString)}if(row0.cells[i].getAttribute("colspan")>1){rowOffset+=row0.cells[i].getAttribute("colspan")-1}}}else if(numOfHeader===3){var rowOffset1=0;var rowOffset2=0;var row0=headerRows[0];for(var i=0,len=row0.cells.length;i<len;i++){if(parseInt(row0.cells[i].getAttribute("rowspan"))===2){array[1].splice(i+rowOffset1,0,rowSpanDummyString)}else if(parseInt(row0.cells[i].getAttribute("rowspan"))===3){array[1].splice(i+rowOffset1,0,rowSpanDummyString);array[2].splice(i+rowOffset2,0,rowSpanDummyString)}if(parseInt(row0.cells[i].getAttribute("colspan"))>1){rowOffset1+=parseInt(row0.cells[i].getAttribute("colspan"))-1;rowOffset2+=parseInt(row0.cells[i].getAttribute("colspan"))-1}}rowOffset2=0;for(var i=0,len=array[2].length;i<len;i++){if(array[2][i]!==rowSpanDummyString){rowOffset2=i;break}}var row1=headerRows[1];for(var i=0,len=row1.cells.length;i<len;i++){if(parseInt(row1.cells[i].getAttribute("rowspan"))===2){array[2].splice(i+rowOffset2,0,rowSpanDummyString)}if(parseInt(row1.cells[i].getAttribute("colspan"))>1){rowOffset2+=parseInt(row1.cells[i].getAttribute("colspan"))-1}}}if(table.checkable===true||table.checkable==="true"){for(var i=0;i<numOfHeader;i++){array[i].shift()}}for(var i=0,len=tableData.length;i<len;i++){var rowData=[];var columnLen=array[0].length;var offset=0;for(var j=0;j<columnLen;j++){if(ths[j].classList.contains("indexable")){offset=1;continue}var data=tableData[i][ths[j].dataField];if(data===undefined)data="";rowData[j-offset]=data}array[i+numOfHeader]=rowData;if(table.indexable&&ths[columnLen-1].dataField!==undefined){if(table.__indexOption&&table.__indexOption.reverse){array[i+numOfHeader].splice(0,0,len-i)}else{array[i+numOfHeader].splice(0,0,i+1)}}}return array};Excel.__tableToJson=function(_table){var rowSpanDummyString="";var colSpanDummyString="";var table=_table.scrollTable?_table.querySelector(".top-tableview-scrollBody table"):_table.querySelector("table");var array=[];var numOfHeader=1;for(var i=0,len=table.rows.length;i<len;i++){array[i]=[];var row=table.rows[i];var colOffset=0;var temp=[];for(var j=0,len2=row.cells.length;j<len2;j++){var cell=row.cells[j];if(cell.children[0]!==undefined&&cell.children[0].tagName==="TOP-SELECTBOX"){array[i].push(cell.children[0].querySelector(".top-selectbox-container").innerText);continue}if(cell.tagName==="TH"){if(cell.getAttribute("value")!=null){array[i].push(cell.getAttribute("value"))}else if(cell.innerText!=null){array[i].push(cell.innerText)}}else if(cell.tagName==="TD"){if(cell.getAttribute("value")!=null)array[i].push(cell.getAttribute("value"));else if(cell.innerText!=null){array[i].push(cell.innerText);if(array[i][j].includes("No data available in table")){array[i][j]=""}}else{var dump="";array[i].push(dump)}}if(cell.getAttribute("colspan")>1){for(var k=1,len3=cell.getAttribute("colspan");k<len3;k++){array[i].splice(j+k+colOffset,0,colSpanDummyString)}colOffset+=parseInt(cell.getAttribute("colspan"))}if(parseInt(cell.getAttribute("rowspan"))>numOfHeader){numOfHeader=parseInt(cell.getAttribute("rowspan"))}}}if(numOfHeader===2){var rowOffset=0;var row0=table.rows[0];for(var i=0,len=row0.cells.length;i<len;i++){if(row0.cells[i].getAttribute("rowspan")>1){array[1].splice(i+rowOffset,0,rowSpanDummyString)}if(row0.cells[i].getAttribute("colspan")>1){rowOffset+=row0.cells[i].getAttribute("colspan")-1}}}else if(numOfHeader===3){var rowOffset1=0;var rowOffset2=0;var row0=table.rows[0];for(var i=0,len=row0.cells.length;i<len;i++){if(parseInt(row0.cells[i].getAttribute("rowspan"))===2){array[1].splice(i+rowOffset1,0,rowSpanDummyString)}else if(parseInt(row0.cells[i].getAttribute("rowspan"))===3){array[1].splice(i+rowOffset1,0,rowSpanDummyString);array[2].splice(i+rowOffset2,0,rowSpanDummyString)}if(parseInt(row0.cells[i].getAttribute("colspan"))>1){rowOffset1+=parseInt(row0.cells[i].getAttribute("colspan"))-1;rowOffset2+=parseInt(row0.cells[i].getAttribute("colspan"))-1}}rowOffset2=0;for(var i=0,len=array[2].length;i<len;i++){if(array[2][i]!==rowSpanDummyString){rowOffset2=i;break}}var row1=table.rows[1];for(var i=0,len=row1.cells.length;i<len;i++){if(parseInt(row1.cells[i].getAttribute("rowspan"))===2){array[2].splice(i+rowOffset2,0,rowSpanDummyString)}if(parseInt(row1.cells[i].getAttribute("colspan"))>1){rowOffset2+=parseInt(row1.cells[i].getAttribute("colspan"))-1}}}if(_table.checkable===true||_table.checkable==="true"){for(var i=0;i<array.length;i++){array[i].shift()}}return array};Excel.__tableToJson_origin=function(table){var rowSpanDummyString="";var colSpanDummyString="";var checkable=false;if(table.checkable===true||table.checkable==="true")checkable=true;var tbl=table.scrollTable?table.querySelector(".top-tableview-scrollBody table"):table.querySelector("table");var rowLength=tbl.rows[0].length;for(var i=0,n=tbl.rows[0].length;i<n;i++){currCell=tbl.rows[0].cells[i];if(currCell.getAttribute("colspan"))rowLength+=parseInt(currCell.getAttribute("colspan"))}var currRow,currCell;var arr=new Array(tbl.rows.length);for(var i=0,n=arr.length;i<n;i++)arr[i]=new Array(rowLength);for(var i=0,n=tbl.rows.length;i<n;i++){currRow=tbl.rows[i];var colOffset=0;for(var j=0,k=currRow.cells.length;j<k;j++){var p=0;while(j+p<arr[i].length&&(arr[i][j+p]==rowSpanDummyString||arr[i][j+p]==colSpanDummyString)){colOffset++;p++}currCell=currRow.cells[j];if(currCell.children[0]!==undefined&&currCell.children[0].tagName==="TOP-SELECTBOX"){arr[i][j+colOffset]=currCell.children[0].querySelector(".top-selectbox-container").innerText;continue}if(currCell.getAttribute("value")!=undefined){arr[i][j+colOffset]=currCell.getAttribute("value")}else if(currCell.innerText!=undefined){arr[i][j+colOffset]=currCell.innerText;if(arr[i][j+colOffset].includes("No data available in table")){arr[i][j+colOffset]=""}}else{arr[i][j+colOffset]=""}if(currCell.getAttribute("rowspan")){for(var p=1,q=parseInt(currCell.getAttribute("rowspan"));p<q;p++)arr[i+p][j+colOffset]=rowSpanDummyString}if(currCell.getAttribute("colspan")){for(var p=1,q=parseInt(currCell.getAttribute("colspan"));p<q;p++){colOffset++;arr[i][j+colOffset]=colSpanDummyString}}}}if(checkable===true){for(var i=0;i<arr.length;i++){arr[i].shift()}}return arr};Excel.__rgbToHex=function(rgb){var rgbRegex=/^rgb\(\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*\)$/;var result,r,g,b,hex="";if(result=rgbRegex.exec(rgb)){r=this.__componentFromStr(result[1],result[2]);g=this.__componentFromStr(result[3],result[4]);b=this.__componentFromStr(result[5],result[6]);hex="#"+(16777216+(r<<16)+(g<<8)+b).toString(16).slice(1)}return hex};Excel.__componentFromStr=function(numStr,percent){var num=Math.max(0,parseInt(numStr,10));return percent?Math.floor(255*Math.min(100,num)/100):Math.min(255,num)};Excel.__s2ab=function(s){var buf=new ArrayBuffer(s.length);var view=new Uint8Array(buf);for(var i=0;i!=s.length;++i)view[i]=s.charCodeAt(i)&255;return buf};Excel.__datenum=function(v,date1904){if(date1904)v+=1462;var epoch=Date.parse(v);return(epoch-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3)};Excel.__sheet_from_array_of_arrays=function(data,children){var ws={};var range={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(var i=0;i<data.length;i++){var cnt=0;var child=children[i];for(key in data[i]){if(key==="contains"||key==="includes")break;if(range.s.r>i)range.s.r=i;if(range.s.c>cnt)range.s.c=cnt;if(range.e.r<i)range.e.r=i;if(range.e.c<cnt)range.e.c=cnt;var cell={v:data[i][key],t:"s"};if(cell.v==null)continue;var cell_ref=XLSX.utils.encode_cell({c:cnt,r:i});ws[cell_ref]=cell;cnt++}}if(range.s.c<1e7)ws["!ref"]=XLSX.utils.encode_range(range);return ws};return Excel}();